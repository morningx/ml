# 背景：


- 客户关系管理的关键问题是客户分类，通过客户分类，区分无价值客户、高价值客户

![image.png](attachment:image.png)

## 目标


* （1）借助数据，对客户进行分类。
* （2）对不同类别的客户进行特征分析，比较不同类客户的客户价值。

## 方法


- RFM模型
* 最近消费时间间隔（Recency） Recency近因；新近性；新近度
* 消费频率（Frenquency） Frenquency率；震动频率
* 消费金额（Monetary）Monetary货币的；金融的；金钱的
- 数据没有标签信息，采⽤聚类的办法进⾏识别客户价值，以 LRFMC 模型为基础


- 1）公司收入的80%来自顶端20%的客户。
- 2）20%的客户其利润率为100%。
- 3）90%以上的收入来自现有客户。
- 4）大部分的营销预算经常被用在非现有客户上。
- 5）5%至30%的客户在客户金字塔中具有升级潜力。
- 6）客户金字塔中客户升级2%，意味着销售收入增加10%，利润增加50%。


- 1）抽取航空公司2012年4月1日至2014年3月31日的数据。
- 2）对抽取的数据进行数据探索分析与预处理，包括数据缺失值与异常值的探索分析、数据清洗、特征构建、标准化等操作。
- 3）基于RFM模型，使用K-Means算法进行客户分群。
- 4）针对模型结果得到不同价值的客户，采用不同的营销手段，提供定制化的服务。

## 模型修改


- 由于航空公司票价受到飞行距离、舱位等级等多种因素影响，同样消费金额的不同旅客对航空公司的价值是不同的。因此单纯的RFM模型并不是适用航空客户价值分析。所以选择客户在一定时间内累积的飞行里程M和客户在一定时间内的平均折扣率C两个指标代替消费金额。另外再增加一个指标就是会员入会时间，这个指标在一定程度也会影响客户价值

- R 为最近乘坐航班时间间隔，F 为⻜⾏次数。消费⾦额需要修改，因为航空票价收到距离和舱位等级的
影响，同样⾦额对航空公司价值不同，因此，需要修改指标。引⼊新的因素： 舱 位 因 素 舱 位 所 对 应 的 折 扣 系 数 的 平 均 值 距 离 因 素 一 定 时 间 内 积 累 的 飞 行 里 程 再考虑到，航空公司的会员系统，⽤户的⼊会时间⻓短能在⼀定程度上影响客户价值，所以增加指标 入 会 时 间 长 度

- 通过对原始数据观察发现数据中存在票价为空值的记录，同时存在票价最小值为0、折扣率最小值为0但总飞行公里数大于0的记录。票价为空值的数据可能是客户不存在乘机记录造成的。其他的数据可能是客户乘坐0折机票或者积分兑换造成的。

## 数据分析步骤


- 步骤1：从航空公司，选择性抽取与新增数据抽取，形成历史数据和增量数据；
- 步骤2：对步骤1的两个数据，进⾏数据探索性分析和预处理，主要有缺失值与异常值的分析处理、属性规约、清洗和变换；
- 步骤3：利⽤步骤2中的已处理数据作为建模数据，基于旅客价值的LRFMC模型进⾏客户分群，对各个客户群再进⾏特征分析，识别有价值客户；
- 步骤4：针对模型结果得到不同价值的客户。采⽤不同的营销⼿段，指定定制化的营销服务，或者针对性的优惠与关怀。


![image.png](attachment:image.png)

# 数据指标

## 确认模型指标

- L：入会时长 R：最近乘坐航班距离样本截止月份数 F：飞行总次数 M：累积飞行总里程 C：平均折扣率 （LRFMC模型）
- 根据航空公司系统内的客户基本信息、乘机信息以及积分信息等详细数据
- 依据末次飞行日期（LAST_FLIGHT_DATE），以2014年3月31日为结束时间，选取宽度为两年的时间段作为分析观测窗口
- 抽取观测窗口2012年4月1日至2014年3月31日内有乘机记录的所有客户的详细数据形成历史数据，总共62988条记录
- 其中包含了会员卡号、入会时间、性别、年龄、会员卡级别、工作地城市、工作地所在省份、工作地所在国家、观测窗口结束时间、观测窗口乘机积分、飞行公里数、飞行次数、飞行时间、乘机时间间隔、平均折扣率等44个属性


![image.png](attachment:image.png)

## 指标定义-客户信息

![image.png](attachment:image.png)

## 指标定义-乘机信息

![image.png](attachment:image.png)

## 指标定义-积分信息

![image.png](attachment:image.png)

# 数据特征值探索

## 导入数据


```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import warnings
warnings.filterwarnings("ignore") 
```


```python
datafile = r"E:\Study\github\MachineLearning\航空公司客户分析\air_data.csv"
resultfile = "E:\Study\github\MachineLearning\航空公司客户分析\explore_result.csv"
datafile,resultfile
```




    ('E:\\Study\\github\\MachineLearning\\航空公司客户分析\\air_data.csv',
     'E:\\Study\\github\\MachineLearning\\航空公司客户分析\\explore_result.csv')




```python
data = pd.read_csv(datafile,encoding='utf-8')
data.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>54993</td>
      <td>2006/11/02</td>
      <td>2008/12/24</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>31.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>39992</td>
      <td>114452</td>
      <td>111100</td>
      <td>619760</td>
      <td>370211</td>
      <td>0.509524</td>
      <td>0.490476</td>
      <td>0.487221</td>
      <td>0.512777</td>
      <td>50</td>
    </tr>
    <tr>
      <td>1</td>
      <td>28065</td>
      <td>2007/02/19</td>
      <td>2007/08/03</td>
      <td>男</td>
      <td>6</td>
      <td>NaN</td>
      <td>北京</td>
      <td>CN</td>
      <td>42.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12000</td>
      <td>53288</td>
      <td>53288</td>
      <td>415768</td>
      <td>238410</td>
      <td>0.514286</td>
      <td>0.485714</td>
      <td>0.489289</td>
      <td>0.510708</td>
      <td>33</td>
    </tr>
    <tr>
      <td>2</td>
      <td>55106</td>
      <td>2007/02/01</td>
      <td>2007/08/30</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>40.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>15491</td>
      <td>55202</td>
      <td>51711</td>
      <td>406361</td>
      <td>233798</td>
      <td>0.518519</td>
      <td>0.481481</td>
      <td>0.481467</td>
      <td>0.518530</td>
      <td>26</td>
    </tr>
    <tr>
      <td>3</td>
      <td>21189</td>
      <td>2008/08/22</td>
      <td>2008/08/23</td>
      <td>男</td>
      <td>5</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>US</td>
      <td>64.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>34890</td>
      <td>34890</td>
      <td>372204</td>
      <td>186100</td>
      <td>0.434783</td>
      <td>0.565217</td>
      <td>0.551722</td>
      <td>0.448275</td>
      <td>12</td>
    </tr>
    <tr>
      <td>4</td>
      <td>39546</td>
      <td>2009/04/10</td>
      <td>2009/04/15</td>
      <td>男</td>
      <td>6</td>
      <td>贵阳</td>
      <td>贵州</td>
      <td>CN</td>
      <td>48.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>22704</td>
      <td>64969</td>
      <td>64969</td>
      <td>338813</td>
      <td>210365</td>
      <td>0.532895</td>
      <td>0.467105</td>
      <td>0.469054</td>
      <td>0.530943</td>
      <td>39</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 44 columns</p>
</div>




```python
data.columns
```




    Index(['MEMBER_NO', 'FFP_DATE', 'FIRST_FLIGHT_DATE', 'GENDER', 'FFP_TIER',
           'WORK_CITY', 'WORK_PROVINCE', 'WORK_COUNTRY', 'AGE', 'LOAD_TIME',
           'FLIGHT_COUNT', 'BP_SUM', 'EP_SUM_YR_1', 'EP_SUM_YR_2', 'SUM_YR_1',
           'SUM_YR_2', 'SEG_KM_SUM', 'WEIGHTED_SEG_KM', 'LAST_FLIGHT_DATE',
           'AVG_FLIGHT_COUNT', 'AVG_BP_SUM', 'BEGIN_TO_FIRST', 'LAST_TO_END',
           'AVG_INTERVAL', 'MAX_INTERVAL', 'ADD_POINTS_SUM_YR_1',
           'ADD_POINTS_SUM_YR_2', 'EXCHANGE_COUNT', 'avg_discount',
           'P1Y_Flight_Count', 'L1Y_Flight_Count', 'P1Y_BP_SUM', 'L1Y_BP_SUM',
           'EP_SUM', 'ADD_Point_SUM', 'Eli_Add_Point_Sum', 'L1Y_ELi_Add_Points',
           'Points_Sum', 'L1Y_Points_Sum', 'Ration_L1Y_Flight_Count',
           'Ration_P1Y_Flight_Count', 'Ration_P1Y_BPS', 'Ration_L1Y_BPS',
           'Point_NotFlight'],
          dtype='object')




```python
data.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_TIER</th>
      <th>AGE</th>
      <th>FLIGHT_COUNT</th>
      <th>BP_SUM</th>
      <th>EP_SUM_YR_1</th>
      <th>EP_SUM_YR_2</th>
      <th>SUM_YR_1</th>
      <th>SUM_YR_2</th>
      <th>SEG_KM_SUM</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>count</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62568.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.0</td>
      <td>62988.000000</td>
      <td>62437.000000</td>
      <td>62850.000000</td>
      <td>62988.000000</td>
      <td>...</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.0000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
    </tr>
    <tr>
      <td>mean</td>
      <td>31494.500000</td>
      <td>4.102162</td>
      <td>42.476346</td>
      <td>11.839414</td>
      <td>10925.081254</td>
      <td>0.0</td>
      <td>265.689623</td>
      <td>5355.376064</td>
      <td>5604.026014</td>
      <td>17123.878691</td>
      <td>...</td>
      <td>1355.006223</td>
      <td>1620.695847</td>
      <td>1080.378882</td>
      <td>12545.7771</td>
      <td>6638.739585</td>
      <td>0.486419</td>
      <td>0.513581</td>
      <td>0.522293</td>
      <td>0.468422</td>
      <td>2.728155</td>
    </tr>
    <tr>
      <td>std</td>
      <td>18183.213715</td>
      <td>0.373856</td>
      <td>9.885915</td>
      <td>14.049471</td>
      <td>16339.486151</td>
      <td>0.0</td>
      <td>1645.702854</td>
      <td>8109.450147</td>
      <td>8703.364247</td>
      <td>20960.844623</td>
      <td>...</td>
      <td>7868.477000</td>
      <td>8294.398955</td>
      <td>5639.857254</td>
      <td>20507.8167</td>
      <td>12601.819863</td>
      <td>0.319105</td>
      <td>0.319105</td>
      <td>0.339632</td>
      <td>0.338956</td>
      <td>7.364164</td>
    </tr>
    <tr>
      <td>min</td>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>6.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>368.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <td>25%</td>
      <td>15747.750000</td>
      <td>4.000000</td>
      <td>35.000000</td>
      <td>3.000000</td>
      <td>2518.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1003.000000</td>
      <td>780.000000</td>
      <td>4747.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2775.0000</td>
      <td>700.000000</td>
      <td>0.250000</td>
      <td>0.288889</td>
      <td>0.258150</td>
      <td>0.167954</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <td>50%</td>
      <td>31494.500000</td>
      <td>4.000000</td>
      <td>41.000000</td>
      <td>7.000000</td>
      <td>5700.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>2800.000000</td>
      <td>2773.000000</td>
      <td>9994.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6328.5000</td>
      <td>2860.500000</td>
      <td>0.500000</td>
      <td>0.500000</td>
      <td>0.514252</td>
      <td>0.476747</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <td>75%</td>
      <td>47241.250000</td>
      <td>4.000000</td>
      <td>48.000000</td>
      <td>15.000000</td>
      <td>12831.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>6574.000000</td>
      <td>6845.750000</td>
      <td>21271.250000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>345.000000</td>
      <td>0.000000</td>
      <td>14302.5000</td>
      <td>7500.000000</td>
      <td>0.711111</td>
      <td>0.750000</td>
      <td>0.815091</td>
      <td>0.728375</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <td>max</td>
      <td>62988.000000</td>
      <td>6.000000</td>
      <td>110.000000</td>
      <td>213.000000</td>
      <td>505308.000000</td>
      <td>0.0</td>
      <td>74460.000000</td>
      <td>239560.000000</td>
      <td>234188.000000</td>
      <td>580717.000000</td>
      <td>...</td>
      <td>984938.000000</td>
      <td>984938.000000</td>
      <td>728282.000000</td>
      <td>985572.0000</td>
      <td>728282.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.999989</td>
      <td>0.999993</td>
      <td>140.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 36 columns</p>
</div>




```python
data.describe(percentiles=[],include='all')

# freq频率；频点；中心频率
# percentiles百分位数值；百分位法；百分位數
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>count</td>
      <td>62988.000000</td>
      <td>62988</td>
      <td>62988</td>
      <td>62985</td>
      <td>62988.000000</td>
      <td>60719</td>
      <td>59740</td>
      <td>62962</td>
      <td>62568.000000</td>
      <td>62988</td>
      <td>...</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.0000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
      <td>62988.000000</td>
    </tr>
    <tr>
      <td>unique</td>
      <td>NaN</td>
      <td>3068</td>
      <td>3406</td>
      <td>2</td>
      <td>NaN</td>
      <td>3310</td>
      <td>1185</td>
      <td>118</td>
      <td>NaN</td>
      <td>1</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <td>top</td>
      <td>NaN</td>
      <td>2011/01/13</td>
      <td>2013/02/16</td>
      <td>男</td>
      <td>NaN</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>NaN</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <td>freq</td>
      <td>NaN</td>
      <td>184</td>
      <td>96</td>
      <td>48134</td>
      <td>NaN</td>
      <td>9385</td>
      <td>17507</td>
      <td>57748</td>
      <td>NaN</td>
      <td>62988</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <td>mean</td>
      <td>31494.500000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.102162</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>42.476346</td>
      <td>NaN</td>
      <td>...</td>
      <td>1355.006223</td>
      <td>1620.695847</td>
      <td>1080.378882</td>
      <td>12545.7771</td>
      <td>6638.739585</td>
      <td>0.486419</td>
      <td>0.513581</td>
      <td>0.522293</td>
      <td>0.468422</td>
      <td>2.728155</td>
    </tr>
    <tr>
      <td>std</td>
      <td>18183.213715</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.373856</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.885915</td>
      <td>NaN</td>
      <td>...</td>
      <td>7868.477000</td>
      <td>8294.398955</td>
      <td>5639.857254</td>
      <td>20507.8167</td>
      <td>12601.819863</td>
      <td>0.319105</td>
      <td>0.319105</td>
      <td>0.339632</td>
      <td>0.338956</td>
      <td>7.364164</td>
    </tr>
    <tr>
      <td>min</td>
      <td>1.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.000000</td>
      <td>NaN</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <td>50%</td>
      <td>31494.500000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>41.000000</td>
      <td>NaN</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6328.5000</td>
      <td>2860.500000</td>
      <td>0.500000</td>
      <td>0.500000</td>
      <td>0.514252</td>
      <td>0.476747</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <td>max</td>
      <td>62988.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>110.000000</td>
      <td>NaN</td>
      <td>...</td>
      <td>984938.000000</td>
      <td>984938.000000</td>
      <td>728282.000000</td>
      <td>985572.0000</td>
      <td>728282.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.999989</td>
      <td>0.999993</td>
      <td>140.000000</td>
    </tr>
  </tbody>
</table>
<p>9 rows × 44 columns</p>
</div>



## 异常值-缺失值 了解

- 对数值型数据进行描述信息查看，得到缺失值及异常值信息


```python
explore = data.describe(percentiles=[],include='all').T
explore

# 转置后查看每一个数值型字段对应的描述信息
# describe()函数自动计算的字段有count（非空值数）、unique（唯一值数）、top（频数最高者）、freq（最高频数）

# 	count	unique	top	freq	mean	std	min	50%	max
# MEMBER_NO	62988	NaN	NaN	NaN	31494.5	18183.2	1	31494.5	62988
# FFP_DATE	62988	3068	2011/01/13	184	NaN	NaN	NaN	NaN	NaN
# FIRST_FLIGHT_DATE	62988	3406	2013/02/16	96	NaN	NaN	NaN	NaN	NaN
```


```python
len(data)
```




    62988




```python
explore['count']

# MEMBER_NO                  62988
# FFP_DATE                   62988
# FIRST_FLIGHT_DATE          62988
# GENDER                     62985
```


```python
explore['null'] = len(data)-explore['count']
explore['null']

# 数据集总行数，减去每一个describe数值型字段的有值个数，得到空值结果

# MEMBER_NO                     0
# FFP_DATE                      0
# FIRST_FLIGHT_DATE             0
# GENDER                        3
# FFP_TIER                      0
# WORK_CITY                  2269
```


```python
explore.head(2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>50%</th>
      <th>max</th>
      <th>null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MEMBER_NO</td>
      <td>62988</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>31494.5</td>
      <td>18183.2</td>
      <td>1</td>
      <td>31494.5</td>
      <td>62988</td>
      <td>0</td>
    </tr>
    <tr>
      <td>FFP_DATE</td>
      <td>62988</td>
      <td>3068</td>
      <td>2011/01/13</td>
      <td>184</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# copy为深入copy 复制新的一份数据在另外的存储空间
explore2 = explore.copy()
explore2.head(2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>50%</th>
      <th>max</th>
      <th>null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MEMBER_NO</td>
      <td>62988</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>31494.5</td>
      <td>18183.2</td>
      <td>1</td>
      <td>31494.5</td>
      <td>62988</td>
      <td>0</td>
    </tr>
    <tr>
      <td>FFP_DATE</td>
      <td>62988</td>
      <td>3068</td>
      <td>2011/01/13</td>
      <td>184</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
explore = explore[['null','max','min']]
explore

#	null	max	min
# MEMBER_NO	0	62988	1
# FFP_DATE	0	NaN	NaN
# FIRST_FLIGHT_DATE	0	NaN	NaN
```


```python
explore2.head(2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>50%</th>
      <th>max</th>
      <th>null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MEMBER_NO</td>
      <td>62988</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>31494.5</td>
      <td>18183.2</td>
      <td>1</td>
      <td>31494.5</td>
      <td>62988</td>
      <td>0</td>
    </tr>
    <tr>
      <td>FFP_DATE</td>
      <td>62988</td>
      <td>3068</td>
      <td>2011/01/13</td>
      <td>184</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
explore.head(2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>null</th>
      <th>max</th>
      <th>min</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MEMBER_NO</td>
      <td>0</td>
      <td>62988</td>
      <td>1</td>
    </tr>
    <tr>
      <td>FFP_DATE</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>




```python
explore.columns = ['空值数','最大值','最小值']
explore.head(2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>空值数</th>
      <th>最大值</th>
      <th>最小值</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MEMBER_NO</td>
      <td>0</td>
      <td>62988</td>
      <td>1</td>
    </tr>
    <tr>
      <td>FFP_DATE</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>




```python
explore.to_csv(resultfile,encoding='utf-8-sig')
# utf-8-sig导出文件为非乱码
# 导出文件到指定目录
```

- 打开文件excel转置后的横排结果

![image.png](attachment:image.png)

## 年月日特征获取年份

- 对时间类型数据通过datetime方法对时间的年月日单独抽取，便于后期对模型在时间特征上进行选取


```python
from datetime import datetime
```


```python
data['FFP_DATE'].loc[0:2]
```




    0    2006/11/02
    1    2007/02/19
    2    2007/02/01
    Name: FFP_DATE, dtype: object




```python
ffp2 = data['FFP_DATE'].loc[0:2].apply(lambda x:datetime.strptime(x,'%Y/%m/%d'))
ffp2
```




    0   2006-11-02
    1   2007-02-19
    2   2007-02-01
    Name: FFP_DATE, dtype: datetime64[ns]




```python
ffp2[0].year,ffp2[0].month,ffp2[0].day
```




    (2006, 11, 2)




```python
ffp = data['FFP_DATE'].apply(lambda x:datetime.strptime(x,'%Y/%m/%d'))
ffp
# 0       2006-11-02
# 1       2007-02-19
# 2       2007-02-01
# 3       2008-08-22
# 4       2009-04-10
```


```python
ffp[0:2]
```




    0   2006-11-02
    1   2007-02-19
    Name: FFP_DATE, dtype: datetime64[ns]




```python
ffp_year = ffp.map(lambda x:x.year)
# series对象运用lambda方法遍历每一个值，获取每一个值的year年份数据
ffp_year
```




    0        2006
    1        2007
    2        2007
    3        2008
    4        2009
             ... 
    62983    2011
    62984    2010
    62985    2006
    62986    2013
    62987    2013
    Name: FFP_DATE, Length: 62988, dtype: int64




```python
ffp_year.value_counts()
```




    2012    14598
    2011    10708
    2010     7648
    2008     6556
    2007     5865
    2009     5653
    2006     4555
    2013     3992
    2005     3078
    2004      335
    Name: FFP_DATE, dtype: int64




```python
data['GENDER'].value_counts()
```




    男    48134
    女    14851
    Name: GENDER, dtype: int64




```python
data['GENDER'].value_counts()['男']
```




    48134




```python
male = data['GENDER'].value_counts()['男']
female = data['GENDER'].value_counts()['女']
male,female
```




    (48134, 14851)




```python
# FFP-TIER 会员卡级别
data['FFP_TIER'].loc[0:3]
```




    0    6
    1    6
    2    6
    3    5
    Name: FFP_TIER, dtype: int64




```python
# FFP-TIER 会员卡级别
data['FFP_TIER'].loc[0:3].value_counts()
```




    6    3
    5    1
    Name: FFP_TIER, dtype: int64




```python
level = data['FFP_TIER'].value_counts()
level = pd.DataFrame(level)
# sns.barplot 柱状图需要数据集DataFrame格式
# 将valuecounts结果的series对象转换成DataFrame对象后
# 可通过index和特征来获取x，y，data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FFP_TIER</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>4</td>
      <td>58066</td>
    </tr>
    <tr>
      <td>5</td>
      <td>3409</td>
    </tr>
    <tr>
      <td>6</td>
      <td>1513</td>
    </tr>
  </tbody>
</table>
</div>




```python
type(level)
```




    pandas.core.series.Series




```python
level.values,level.index
```




    (array([58066,  3409,  1513], dtype=int64),
     Int64Index([4, 5, 6], dtype='int64'))




```python
level4 = data['FFP_TIER'].value_counts()[4]
level4
```




    58066




```python
level5 = data['FFP_TIER'].value_counts()[5]
level5
```




    3409




```python
level6 = data['FFP_TIER'].value_counts()[6]
level6
```




    1513




```python
data['AGE'].loc[0:2].value_counts()
```




    40.0    1
    42.0    1
    31.0    1
    Name: AGE, dtype: int64




```python
explore2['count']['AGE']
```




    62568.0




```python
len(data)
```




    62988




```python
len(data)-explore2['count']['AGE']
# explore2为转置后的describe，可通过count字段来获取值，只调取age行的结果
# 总的data行数，减去，age非空的行数，得到，缺失值age行数
```




    420.0




```python
len(data[data['AGE'].isnull()])
```




    420




```python
age = data['AGE'].dropna(axis=0,how='any')
age = age.astype('int64')
age[age.isnull() == False ]
```




    0        31
    1        42
    2        40
    3        64
    4        48
             ..
    62983    25
    62984    38
    62985    43
    62986    36
    62987    29
    Name: AGE, Length: 62568, dtype: int64




```python
age[age != 'Nan']
```




    0        31
    1        42
    2        40
    3        64
    4        48
             ..
    62983    25
    62984    38
    62985    43
    62986    36
    62987    29
    Name: AGE, Length: 62568, dtype: int64




```python
len(data)-len(age[age != 'Nan'])
# 存在年龄为Nan结果的有420
```




    420




```python
# data['AGE'].loc[0:2].value_counts()
age2 = data['AGE'].value_counts()
len(age2.index),age2.index.sort_values()
# plt.barplot()
```




    (84,
     Float64Index([  6.0,   7.0,   9.0,  12.0,  13.0,  14.0,  15.0,  16.0,  17.0,
                    18.0,  19.0,  20.0,  21.0,  22.0,  23.0,  24.0,  25.0,  26.0,
                    27.0,  28.0,  29.0,  30.0,  31.0,  32.0,  33.0,  34.0,  35.0,
                    36.0,  37.0,  38.0,  39.0,  40.0,  41.0,  42.0,  43.0,  44.0,
                    45.0,  46.0,  47.0,  48.0,  49.0,  50.0,  51.0,  52.0,  53.0,
                    54.0,  55.0,  56.0,  57.0,  58.0,  59.0,  60.0,  61.0,  62.0,
                    63.0,  64.0,  65.0,  66.0,  67.0,  68.0,  69.0,  70.0,  71.0,
                    72.0,  73.0,  74.0,  75.0,  76.0,  77.0,  78.0,  79.0,  80.0,
                    81.0,  82.0,  83.0,  84.0,  85.0,  86.0,  87.0,  88.0,  89.0,
                    91.0,  92.0, 110.0],
                  dtype='float64'))




```python
age = data['AGE'].dropna().astype('int64')
age

# data['AGE'].astype('int64')
# ValueError: Cannot convert non-finite values (NA or inf) to integer

# data['AGE'].dropna().astype('int64').value_counts()
# 47     2727
# 38     2713
# 37     2683
# 42     2622
# 39     2595
```




    0        31
    1        42
    2        40
    3        64
    4        48
             ..
    62983    25
    62984    38
    62985    43
    62986    36
    62987    29
    Name: AGE, Length: 62568, dtype: int64




```python
data[['LAST_TO_END','FLIGHT_COUNT','SEG_KM_SUM']]

# FLIGHT_COUNT 飞行次数统计
# LAST_TO_END 最后一次乘车时间
# SEG_KM_SUM 飞行公里数统计

# LAST_TO_END	FLIGHT_COUNT	SEG_KM_SUM
# 0	1	210	580717
# 1	7	140	293678
# 2	11	135	283712
```

# 数据特征分布图

## 年份注册会员柱状图

- 了解公司在会员投入方面情况


```python
plt.rcParams['font.sans-serif'] = 'SimHei'
plt.rcParams['axes.unicode_minus'] = False
plt.figure(figsize=(10,4))
plt.hist(ffp_year,bins='auto')
plt.xlabel('年份')
plt.ylabel('不同年份注册会员人数')

# hist 统计频数直方图 年份为连续性变量 可以用直方图来表示
```




    Text(0, 0.5, '不同年份注册会员人数')




![png](output_59_1.png)


## 会员男女比例饼图

- 查看不同性别群体倾向消费信息


```python
plt.figure(figsize=(8,4))
plt.pie([male,female],labels=['男','女'],autopct='%1.1f%%')
plt.title('不同会员的比例')
```




    Text(0.5, 1.0, '不同会员的比例')




![png](output_61_1.png)


## 会员等级分布图

- 了解会员对公司的忠诚度信息


```python
import seaborn as sns
# sns.barplot(left=range(3),height=[level4,level5,level6])
sns.barplot(x=level.index,y=level.FFP_TIER,data=level)
# plt.xticks = ([index for index in range(3)],['等级4','等级5','等级6'])
plt.xlabel('会员等级')
plt.ylabel('会员人数')
plt.show()
```


![png](output_63_0.png)


## 会员年龄饼图

- 了解公司会员在年龄上倾向性消费群体


```python
# 年龄的饼图，获取每个年龄的统计结果index和values

plt.figure(figsize=(10,5))
plt.pie(age2.values,labels=age2.index,autopct='%1.1f%%');
```


![png](output_65_0.png)


## 会员年龄箱线图

- 了解会员年龄的异常值情况，筛选出极端异常值进行删除或修改处理


```python
# 大部分会员用户集中在30-50岁，少部分年轻人小于20岁，异常值超过100岁1个

plt.figure(figsize=(15,5))
plt.boxplot(age,labels=['会员年龄'],vert=False,patch_artist=True);
```


![png](output_67_0.png)


## 飞行次数/公里数/月时长 箱线图

- FLIGHT_COUNT
- 飞行次数特征，集中在0-20区间，超过40的群体为上限值上方
- SEG_KM_SUM
- 飞行公里数特征，大部分在箱线图内为5-20区间，超出上限值在上方结合飞行次数和飞行公里数特征
- 结合飞行次数和飞行公里数特征，次数多且公里数多，则可能存在高净值忠实客户
- LAST_TO_END
- 飞行时长月份数，大部分在10-280之间，少部分在600以上，少部分群体可能已经流失


```python
# data[['LAST_TO_END','FLIGHT_COUNT','SEG_KM_SUM']]

plt.figure(figsize=(10,6))
p1 = plt.subplot(131)
p2 = plt.subplot(132)
p3 = plt.subplot(133)

p1.boxplot(data['FLIGHT_COUNT'],labels=['飞行总次数'])
p1.grid(linestyle=":", alpha=0.9)
p2.boxplot(data['SEG_KM_SUM'],labels=['飞行公里数'])
p2.grid(linestyle=":", alpha=0.9)
p3.boxplot(data['LAST_TO_END'],labels=['最后乘机时间距截止时间时长'])
p3.grid(linestyle=":", alpha=0.9);
```


![png](output_69_0.png)


## 会员积分兑换次数 直方图

- 由直方图可知，大部分会员用户群体坐落在0-10次积分兑换区间


```python
print(data['EXCHANGE_COUNT'].describe())
```

    count    62988.000000
    mean         0.319775
    std          1.136004
    min          0.000000
    25%          0.000000
    50%          0.000000
    75%          0.000000
    max         46.000000
    Name: EXCHANGE_COUNT, dtype: float64
    


```python
print(data['EXCHANGE_COUNT'].sort_values(ascending=False)[0:10])
```

    974      46
    2493     37
    0        34
    1        29
    4        27
    47636    27
    1270     27
    60984    22
    185      22
    1266     21
    Name: EXCHANGE_COUNT, dtype: int64
    


```python
# data['EXCHANGE_COUNT']

plt.hist(data['EXCHANGE_COUNT'],bins=100)
plt.title('会员兑换次数统计')
plt.xlabel('会员人数')
plt.ylabel('会员兑换次数');
```


![png](output_73_0.png)


## 会员累计积分 箱线图

- 一部分群体在箱子内，一部分群体在箱体上限值上方


```python
# Points_Sum 积分兑换总和
plt.figure(figsize=(15,5))
plt.grid(linestyle=":", alpha=0.9)
plt.boxplot(data['Points_Sum'],labels=['会员累计积分'],vert=False);
```


![png](output_75_0.png)


# 相关性分析

- L：入会时间 R：最近乘坐航班 F：飞行次数 M：累积飞行里程 C：平均折扣率 （LRFMC模型）
- 结合后期要做的聚类模型主要参数去找相关性矩阵进行输出相关系数

## 相关性矩阵数据

- 入会时间，会员卡级别，客户年龄，飞行次数，总飞行公里数，最近乘积至结束时长，积分兑换次数，总累计积分，为主要相关性分析变量


```python
data_corr = data[['FFP_TIER','FLIGHT_COUNT','LAST_TO_END','SEG_KM_SUM','EXCHANGE_COUNT','Points_Sum']]
data_corr
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FFP_TIER</th>
      <th>FLIGHT_COUNT</th>
      <th>LAST_TO_END</th>
      <th>SEG_KM_SUM</th>
      <th>EXCHANGE_COUNT</th>
      <th>Points_Sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>6</td>
      <td>210</td>
      <td>1</td>
      <td>580717</td>
      <td>34</td>
      <td>619760</td>
    </tr>
    <tr>
      <td>1</td>
      <td>6</td>
      <td>140</td>
      <td>7</td>
      <td>293678</td>
      <td>29</td>
      <td>415768</td>
    </tr>
    <tr>
      <td>2</td>
      <td>6</td>
      <td>135</td>
      <td>11</td>
      <td>283712</td>
      <td>20</td>
      <td>406361</td>
    </tr>
    <tr>
      <td>3</td>
      <td>5</td>
      <td>23</td>
      <td>97</td>
      <td>281336</td>
      <td>11</td>
      <td>372204</td>
    </tr>
    <tr>
      <td>4</td>
      <td>6</td>
      <td>152</td>
      <td>5</td>
      <td>309928</td>
      <td>27</td>
      <td>338813</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>62983</td>
      <td>4</td>
      <td>2</td>
      <td>297</td>
      <td>1134</td>
      <td>1</td>
      <td>12318</td>
    </tr>
    <tr>
      <td>62984</td>
      <td>4</td>
      <td>4</td>
      <td>89</td>
      <td>8016</td>
      <td>14</td>
      <td>106972</td>
    </tr>
    <tr>
      <td>62985</td>
      <td>4</td>
      <td>2</td>
      <td>29</td>
      <td>2594</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62986</td>
      <td>4</td>
      <td>2</td>
      <td>400</td>
      <td>3934</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62987</td>
      <td>4</td>
      <td>2</td>
      <td>403</td>
      <td>4222</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>62988 rows × 6 columns</p>
</div>




```python
data_corr['AGE'] = data['AGE'].fillna(0)
data_corr.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FFP_TIER</th>
      <th>FLIGHT_COUNT</th>
      <th>LAST_TO_END</th>
      <th>SEG_KM_SUM</th>
      <th>EXCHANGE_COUNT</th>
      <th>Points_Sum</th>
      <th>AGE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>6</td>
      <td>210</td>
      <td>1</td>
      <td>580717</td>
      <td>34</td>
      <td>619760</td>
      <td>31.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>6</td>
      <td>140</td>
      <td>7</td>
      <td>293678</td>
      <td>29</td>
      <td>415768</td>
      <td>42.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>6</td>
      <td>135</td>
      <td>11</td>
      <td>283712</td>
      <td>20</td>
      <td>406361</td>
      <td>40.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>5</td>
      <td>23</td>
      <td>97</td>
      <td>281336</td>
      <td>11</td>
      <td>372204</td>
      <td>64.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>6</td>
      <td>152</td>
      <td>5</td>
      <td>309928</td>
      <td>27</td>
      <td>338813</td>
      <td>48.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
data_corr['ffp_year'] = ffp_year
data_corr.head(2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FFP_TIER</th>
      <th>FLIGHT_COUNT</th>
      <th>LAST_TO_END</th>
      <th>SEG_KM_SUM</th>
      <th>EXCHANGE_COUNT</th>
      <th>Points_Sum</th>
      <th>AGE</th>
      <th>ffp_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>6</td>
      <td>210</td>
      <td>1</td>
      <td>580717</td>
      <td>34</td>
      <td>619760</td>
      <td>31.0</td>
      <td>2006</td>
    </tr>
    <tr>
      <td>1</td>
      <td>6</td>
      <td>140</td>
      <td>7</td>
      <td>293678</td>
      <td>29</td>
      <td>415768</td>
      <td>42.0</td>
      <td>2007</td>
    </tr>
  </tbody>
</table>
</div>




```python
datacorr = data_corr.corr(method='pearson')
datacorr
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FFP_TIER</th>
      <th>FLIGHT_COUNT</th>
      <th>LAST_TO_END</th>
      <th>SEG_KM_SUM</th>
      <th>EXCHANGE_COUNT</th>
      <th>Points_Sum</th>
      <th>AGE</th>
      <th>ffp_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>FFP_TIER</td>
      <td>1.000000</td>
      <td>0.582447</td>
      <td>-0.206313</td>
      <td>0.522350</td>
      <td>0.342355</td>
      <td>0.559249</td>
      <td>0.076245</td>
      <td>-0.116510</td>
    </tr>
    <tr>
      <td>FLIGHT_COUNT</td>
      <td>0.582447</td>
      <td>1.000000</td>
      <td>-0.404999</td>
      <td>0.850411</td>
      <td>0.502501</td>
      <td>0.747092</td>
      <td>0.075309</td>
      <td>-0.188181</td>
    </tr>
    <tr>
      <td>LAST_TO_END</td>
      <td>-0.206313</td>
      <td>-0.404999</td>
      <td>1.000000</td>
      <td>-0.369509</td>
      <td>-0.169717</td>
      <td>-0.292027</td>
      <td>-0.027654</td>
      <td>0.117913</td>
    </tr>
    <tr>
      <td>SEG_KM_SUM</td>
      <td>0.522350</td>
      <td>0.850411</td>
      <td>-0.369509</td>
      <td>1.000000</td>
      <td>0.507819</td>
      <td>0.853014</td>
      <td>0.087285</td>
      <td>-0.171508</td>
    </tr>
    <tr>
      <td>EXCHANGE_COUNT</td>
      <td>0.342355</td>
      <td>0.502501</td>
      <td>-0.169717</td>
      <td>0.507819</td>
      <td>1.000000</td>
      <td>0.578581</td>
      <td>0.032760</td>
      <td>-0.216610</td>
    </tr>
    <tr>
      <td>Points_Sum</td>
      <td>0.559249</td>
      <td>0.747092</td>
      <td>-0.292027</td>
      <td>0.853014</td>
      <td>0.578581</td>
      <td>1.000000</td>
      <td>0.074887</td>
      <td>-0.163431</td>
    </tr>
    <tr>
      <td>AGE</td>
      <td>0.076245</td>
      <td>0.075309</td>
      <td>-0.027654</td>
      <td>0.087285</td>
      <td>0.032760</td>
      <td>0.074887</td>
      <td>1.000000</td>
      <td>-0.242579</td>
    </tr>
    <tr>
      <td>ffp_year</td>
      <td>-0.116510</td>
      <td>-0.188181</td>
      <td>0.117913</td>
      <td>-0.171508</td>
      <td>-0.216610</td>
      <td>-0.163431</td>
      <td>-0.242579</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>



## 相关矩阵可视化热力图

- fightcount飞行次数 和 segkmsum飞行公里数 具有强相关性 0.85
- fightcount飞行次数 和 pointssum积分累计总数 具有较强相关性 0.75


```python
plt.figure(figsize=(10,4))
sns.heatmap(datacorr,annot=True,cmap='Blues')
```




    <matplotlib.axes._subplots.AxesSubplot at 0x1cdb707b948>




![png](output_83_1.png)


# 数据预处理

- 数据值清洗，属性归约缩放值范围到0-1区间，新增计算后的特征变量


```python
data.head(2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>54993</td>
      <td>2006/11/02</td>
      <td>2008/12/24</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>31.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>39992</td>
      <td>114452</td>
      <td>111100</td>
      <td>619760</td>
      <td>370211</td>
      <td>0.509524</td>
      <td>0.490476</td>
      <td>0.487221</td>
      <td>0.512777</td>
      <td>50</td>
    </tr>
    <tr>
      <td>1</td>
      <td>28065</td>
      <td>2007/02/19</td>
      <td>2007/08/03</td>
      <td>男</td>
      <td>6</td>
      <td>NaN</td>
      <td>北京</td>
      <td>CN</td>
      <td>42.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12000</td>
      <td>53288</td>
      <td>53288</td>
      <td>415768</td>
      <td>238410</td>
      <td>0.514286</td>
      <td>0.485714</td>
      <td>0.489289</td>
      <td>0.510708</td>
      <td>33</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 44 columns</p>
</div>



## 年龄异常值


```python
## 丢弃年龄异常数据大于100的值

data[data['AGE']>100]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>23268</td>
      <td>20264</td>
      <td>2005/04/14</td>
      <td>2005/05/18</td>
      <td>女</td>
      <td>4</td>
      <td>深圳市</td>
      <td>广东</td>
      <td>CN</td>
      <td>110.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>299</td>
      <td>299</td>
      <td>99</td>
      <td>11194</td>
      <td>4033</td>
      <td>0.285714</td>
      <td>0.714286</td>
      <td>0.638858</td>
      <td>0.36105</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 44 columns</p>
</div>




```python
data_age = data[data['AGE']<100]
data_age
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>54993</td>
      <td>2006/11/02</td>
      <td>2008/12/24</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>31.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>39992</td>
      <td>114452</td>
      <td>111100</td>
      <td>619760</td>
      <td>370211</td>
      <td>0.509524</td>
      <td>0.490476</td>
      <td>0.487221</td>
      <td>0.512777</td>
      <td>50</td>
    </tr>
    <tr>
      <td>1</td>
      <td>28065</td>
      <td>2007/02/19</td>
      <td>2007/08/03</td>
      <td>男</td>
      <td>6</td>
      <td>NaN</td>
      <td>北京</td>
      <td>CN</td>
      <td>42.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12000</td>
      <td>53288</td>
      <td>53288</td>
      <td>415768</td>
      <td>238410</td>
      <td>0.514286</td>
      <td>0.485714</td>
      <td>0.489289</td>
      <td>0.510708</td>
      <td>33</td>
    </tr>
    <tr>
      <td>2</td>
      <td>55106</td>
      <td>2007/02/01</td>
      <td>2007/08/30</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>40.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>15491</td>
      <td>55202</td>
      <td>51711</td>
      <td>406361</td>
      <td>233798</td>
      <td>0.518519</td>
      <td>0.481481</td>
      <td>0.481467</td>
      <td>0.518530</td>
      <td>26</td>
    </tr>
    <tr>
      <td>3</td>
      <td>21189</td>
      <td>2008/08/22</td>
      <td>2008/08/23</td>
      <td>男</td>
      <td>5</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>US</td>
      <td>64.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>34890</td>
      <td>34890</td>
      <td>372204</td>
      <td>186100</td>
      <td>0.434783</td>
      <td>0.565217</td>
      <td>0.551722</td>
      <td>0.448275</td>
      <td>12</td>
    </tr>
    <tr>
      <td>4</td>
      <td>39546</td>
      <td>2009/04/10</td>
      <td>2009/04/15</td>
      <td>男</td>
      <td>6</td>
      <td>贵阳</td>
      <td>贵州</td>
      <td>CN</td>
      <td>48.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>22704</td>
      <td>64969</td>
      <td>64969</td>
      <td>338813</td>
      <td>210365</td>
      <td>0.532895</td>
      <td>0.467105</td>
      <td>0.469054</td>
      <td>0.530943</td>
      <td>39</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>62983</td>
      <td>18375</td>
      <td>2011/05/20</td>
      <td>2013/06/05</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>25.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12318</td>
      <td>12318</td>
      <td>12123</td>
      <td>12318</td>
      <td>12123</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>22</td>
    </tr>
    <tr>
      <td>62984</td>
      <td>36041</td>
      <td>2010/03/08</td>
      <td>2013/09/14</td>
      <td>男</td>
      <td>4</td>
      <td>佛山</td>
      <td>广东</td>
      <td>CN</td>
      <td>38.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>106972</td>
      <td>106972</td>
      <td>56506</td>
      <td>106972</td>
      <td>56506</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>43</td>
    </tr>
    <tr>
      <td>62985</td>
      <td>45690</td>
      <td>2006/03/30</td>
      <td>2006/12/02</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>43.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62986</td>
      <td>61027</td>
      <td>2013/02/06</td>
      <td>2013/02/14</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>36.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62987</td>
      <td>61340</td>
      <td>2013/02/17</td>
      <td>2013/02/17</td>
      <td>女</td>
      <td>4</td>
      <td>上海</td>
      <td>.</td>
      <td>CN</td>
      <td>29.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>62567 rows × 44 columns</p>
</div>



## 每年总票价异常值

- sumyr为第一年和第二年总票价

![image.png](attachment:image.png)


```python
10 and 100,10 or 100,10 & 100,10 | 100
```




    (100, 10, 0, 110)




```python
len(data),len(data[data['SUM_YR_1'].isnull()]['SUM_YR_1']),len(data[data['SUM_YR_1'].notnull()])

# 存在第一年总花钱票价格为551行空值
```




    (62988, 551, 62437)




```python
len(data),len(data[data['SUM_YR_2'].isnull()]['SUM_YR_2']),len(data[data['SUM_YR_2'].notnull()])

# 存在第二年总花钱票价格为138行空值
```




    (62988, 138, 62850)




```python
data_sumyr1 = data_age[data_age['SUM_YR_1'].notnull()]
data_sumyr1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>54993</td>
      <td>2006/11/02</td>
      <td>2008/12/24</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>31.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>39992</td>
      <td>114452</td>
      <td>111100</td>
      <td>619760</td>
      <td>370211</td>
      <td>0.509524</td>
      <td>0.490476</td>
      <td>0.487221</td>
      <td>0.512777</td>
      <td>50</td>
    </tr>
    <tr>
      <td>1</td>
      <td>28065</td>
      <td>2007/02/19</td>
      <td>2007/08/03</td>
      <td>男</td>
      <td>6</td>
      <td>NaN</td>
      <td>北京</td>
      <td>CN</td>
      <td>42.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12000</td>
      <td>53288</td>
      <td>53288</td>
      <td>415768</td>
      <td>238410</td>
      <td>0.514286</td>
      <td>0.485714</td>
      <td>0.489289</td>
      <td>0.510708</td>
      <td>33</td>
    </tr>
    <tr>
      <td>2</td>
      <td>55106</td>
      <td>2007/02/01</td>
      <td>2007/08/30</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>40.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>15491</td>
      <td>55202</td>
      <td>51711</td>
      <td>406361</td>
      <td>233798</td>
      <td>0.518519</td>
      <td>0.481481</td>
      <td>0.481467</td>
      <td>0.518530</td>
      <td>26</td>
    </tr>
    <tr>
      <td>3</td>
      <td>21189</td>
      <td>2008/08/22</td>
      <td>2008/08/23</td>
      <td>男</td>
      <td>5</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>US</td>
      <td>64.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>34890</td>
      <td>34890</td>
      <td>372204</td>
      <td>186100</td>
      <td>0.434783</td>
      <td>0.565217</td>
      <td>0.551722</td>
      <td>0.448275</td>
      <td>12</td>
    </tr>
    <tr>
      <td>4</td>
      <td>39546</td>
      <td>2009/04/10</td>
      <td>2009/04/15</td>
      <td>男</td>
      <td>6</td>
      <td>贵阳</td>
      <td>贵州</td>
      <td>CN</td>
      <td>48.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>22704</td>
      <td>64969</td>
      <td>64969</td>
      <td>338813</td>
      <td>210365</td>
      <td>0.532895</td>
      <td>0.467105</td>
      <td>0.469054</td>
      <td>0.530943</td>
      <td>39</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>62982</td>
      <td>16415</td>
      <td>2013/01/20</td>
      <td>2013/01/20</td>
      <td>女</td>
      <td>4</td>
      <td>北京</td>
      <td>.</td>
      <td>CN</td>
      <td>35.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62983</td>
      <td>18375</td>
      <td>2011/05/20</td>
      <td>2013/06/05</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>25.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12318</td>
      <td>12318</td>
      <td>12123</td>
      <td>12318</td>
      <td>12123</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>22</td>
    </tr>
    <tr>
      <td>62984</td>
      <td>36041</td>
      <td>2010/03/08</td>
      <td>2013/09/14</td>
      <td>男</td>
      <td>4</td>
      <td>佛山</td>
      <td>广东</td>
      <td>CN</td>
      <td>38.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>106972</td>
      <td>106972</td>
      <td>56506</td>
      <td>106972</td>
      <td>56506</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>43</td>
    </tr>
    <tr>
      <td>62985</td>
      <td>45690</td>
      <td>2006/03/30</td>
      <td>2006/12/02</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>43.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62986</td>
      <td>61027</td>
      <td>2013/02/06</td>
      <td>2013/02/14</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>36.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>62020 rows × 44 columns</p>
</div>




```python
data_sumyr2 = data_sumyr1[data_sumyr1['SUM_YR_2'].notnull()]
data_sumyr2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>54993</td>
      <td>2006/11/02</td>
      <td>2008/12/24</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>31.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>39992</td>
      <td>114452</td>
      <td>111100</td>
      <td>619760</td>
      <td>370211</td>
      <td>0.509524</td>
      <td>0.490476</td>
      <td>0.487221</td>
      <td>0.512777</td>
      <td>50</td>
    </tr>
    <tr>
      <td>1</td>
      <td>28065</td>
      <td>2007/02/19</td>
      <td>2007/08/03</td>
      <td>男</td>
      <td>6</td>
      <td>NaN</td>
      <td>北京</td>
      <td>CN</td>
      <td>42.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12000</td>
      <td>53288</td>
      <td>53288</td>
      <td>415768</td>
      <td>238410</td>
      <td>0.514286</td>
      <td>0.485714</td>
      <td>0.489289</td>
      <td>0.510708</td>
      <td>33</td>
    </tr>
    <tr>
      <td>2</td>
      <td>55106</td>
      <td>2007/02/01</td>
      <td>2007/08/30</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>40.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>15491</td>
      <td>55202</td>
      <td>51711</td>
      <td>406361</td>
      <td>233798</td>
      <td>0.518519</td>
      <td>0.481481</td>
      <td>0.481467</td>
      <td>0.518530</td>
      <td>26</td>
    </tr>
    <tr>
      <td>3</td>
      <td>21189</td>
      <td>2008/08/22</td>
      <td>2008/08/23</td>
      <td>男</td>
      <td>5</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>US</td>
      <td>64.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>34890</td>
      <td>34890</td>
      <td>372204</td>
      <td>186100</td>
      <td>0.434783</td>
      <td>0.565217</td>
      <td>0.551722</td>
      <td>0.448275</td>
      <td>12</td>
    </tr>
    <tr>
      <td>4</td>
      <td>39546</td>
      <td>2009/04/10</td>
      <td>2009/04/15</td>
      <td>男</td>
      <td>6</td>
      <td>贵阳</td>
      <td>贵州</td>
      <td>CN</td>
      <td>48.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>22704</td>
      <td>64969</td>
      <td>64969</td>
      <td>338813</td>
      <td>210365</td>
      <td>0.532895</td>
      <td>0.467105</td>
      <td>0.469054</td>
      <td>0.530943</td>
      <td>39</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>62982</td>
      <td>16415</td>
      <td>2013/01/20</td>
      <td>2013/01/20</td>
      <td>女</td>
      <td>4</td>
      <td>北京</td>
      <td>.</td>
      <td>CN</td>
      <td>35.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62983</td>
      <td>18375</td>
      <td>2011/05/20</td>
      <td>2013/06/05</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>25.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12318</td>
      <td>12318</td>
      <td>12123</td>
      <td>12318</td>
      <td>12123</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>22</td>
    </tr>
    <tr>
      <td>62984</td>
      <td>36041</td>
      <td>2010/03/08</td>
      <td>2013/09/14</td>
      <td>男</td>
      <td>4</td>
      <td>佛山</td>
      <td>广东</td>
      <td>CN</td>
      <td>38.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>106972</td>
      <td>106972</td>
      <td>56506</td>
      <td>106972</td>
      <td>56506</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>43</td>
    </tr>
    <tr>
      <td>62985</td>
      <td>45690</td>
      <td>2006/03/30</td>
      <td>2006/12/02</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>43.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62986</td>
      <td>61027</td>
      <td>2013/02/06</td>
      <td>2013/02/14</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>36.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>61883 rows × 44 columns</p>
</div>



## 飞行公里数异常值

- 通过value_counts对相同值进行计数发现为0km的值没有，可能在处理年龄和每年的总票价上给删除了


```python
data_sumyr2['SEG_KM_SUM'].value_counts()
```




    3934     295
    4154     178
    2616     178
    1298     141
    1158     114
            ... 
    6446       1
    42252      1
    14634      1
    44301      1
    12310      1
    Name: SEG_KM_SUM, Length: 28985, dtype: int64




```python
data_sumyr2[data_sumyr2['SEG_KM_SUM'] == 12310]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>23775</td>
      <td>35796</td>
      <td>2006/10/12</td>
      <td>2006/10/12</td>
      <td>男</td>
      <td>4</td>
      <td>长春</td>
      <td>吉林</td>
      <td>CN</td>
      <td>60.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>9789</td>
      <td>3304</td>
      <td>0.3</td>
      <td>0.7</td>
      <td>0.662411</td>
      <td>0.337487</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 44 columns</p>
</div>




```python
data_sumyr2[data_sumyr2['SEG_KM_SUM'] == 0]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
<p>0 rows × 44 columns</p>
</div>




```python
data_sumyr2[data_sumyr2['SEG_KM_SUM'] != 0]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>54993</td>
      <td>2006/11/02</td>
      <td>2008/12/24</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>31.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>39992</td>
      <td>114452</td>
      <td>111100</td>
      <td>619760</td>
      <td>370211</td>
      <td>0.509524</td>
      <td>0.490476</td>
      <td>0.487221</td>
      <td>0.512777</td>
      <td>50</td>
    </tr>
    <tr>
      <td>1</td>
      <td>28065</td>
      <td>2007/02/19</td>
      <td>2007/08/03</td>
      <td>男</td>
      <td>6</td>
      <td>NaN</td>
      <td>北京</td>
      <td>CN</td>
      <td>42.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12000</td>
      <td>53288</td>
      <td>53288</td>
      <td>415768</td>
      <td>238410</td>
      <td>0.514286</td>
      <td>0.485714</td>
      <td>0.489289</td>
      <td>0.510708</td>
      <td>33</td>
    </tr>
    <tr>
      <td>2</td>
      <td>55106</td>
      <td>2007/02/01</td>
      <td>2007/08/30</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>40.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>15491</td>
      <td>55202</td>
      <td>51711</td>
      <td>406361</td>
      <td>233798</td>
      <td>0.518519</td>
      <td>0.481481</td>
      <td>0.481467</td>
      <td>0.518530</td>
      <td>26</td>
    </tr>
    <tr>
      <td>3</td>
      <td>21189</td>
      <td>2008/08/22</td>
      <td>2008/08/23</td>
      <td>男</td>
      <td>5</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>US</td>
      <td>64.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>34890</td>
      <td>34890</td>
      <td>372204</td>
      <td>186100</td>
      <td>0.434783</td>
      <td>0.565217</td>
      <td>0.551722</td>
      <td>0.448275</td>
      <td>12</td>
    </tr>
    <tr>
      <td>4</td>
      <td>39546</td>
      <td>2009/04/10</td>
      <td>2009/04/15</td>
      <td>男</td>
      <td>6</td>
      <td>贵阳</td>
      <td>贵州</td>
      <td>CN</td>
      <td>48.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>22704</td>
      <td>64969</td>
      <td>64969</td>
      <td>338813</td>
      <td>210365</td>
      <td>0.532895</td>
      <td>0.467105</td>
      <td>0.469054</td>
      <td>0.530943</td>
      <td>39</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>62982</td>
      <td>16415</td>
      <td>2013/01/20</td>
      <td>2013/01/20</td>
      <td>女</td>
      <td>4</td>
      <td>北京</td>
      <td>.</td>
      <td>CN</td>
      <td>35.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62983</td>
      <td>18375</td>
      <td>2011/05/20</td>
      <td>2013/06/05</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>25.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12318</td>
      <td>12318</td>
      <td>12123</td>
      <td>12318</td>
      <td>12123</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>22</td>
    </tr>
    <tr>
      <td>62984</td>
      <td>36041</td>
      <td>2010/03/08</td>
      <td>2013/09/14</td>
      <td>男</td>
      <td>4</td>
      <td>佛山</td>
      <td>广东</td>
      <td>CN</td>
      <td>38.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>106972</td>
      <td>106972</td>
      <td>56506</td>
      <td>106972</td>
      <td>56506</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>43</td>
    </tr>
    <tr>
      <td>62985</td>
      <td>45690</td>
      <td>2006/03/30</td>
      <td>2006/12/02</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>43.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62986</td>
      <td>61027</td>
      <td>2013/02/06</td>
      <td>2013/02/14</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>36.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>61883 rows × 44 columns</p>
</div>




```python
data_kmsum = data_sumyr2[data_sumyr2['SEG_KM_SUM'].notnull()]
data_kmsum
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MEMBER_NO</th>
      <th>FFP_DATE</th>
      <th>FIRST_FLIGHT_DATE</th>
      <th>GENDER</th>
      <th>FFP_TIER</th>
      <th>WORK_CITY</th>
      <th>WORK_PROVINCE</th>
      <th>WORK_COUNTRY</th>
      <th>AGE</th>
      <th>LOAD_TIME</th>
      <th>...</th>
      <th>ADD_Point_SUM</th>
      <th>Eli_Add_Point_Sum</th>
      <th>L1Y_ELi_Add_Points</th>
      <th>Points_Sum</th>
      <th>L1Y_Points_Sum</th>
      <th>Ration_L1Y_Flight_Count</th>
      <th>Ration_P1Y_Flight_Count</th>
      <th>Ration_P1Y_BPS</th>
      <th>Ration_L1Y_BPS</th>
      <th>Point_NotFlight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>54993</td>
      <td>2006/11/02</td>
      <td>2008/12/24</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>31.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>39992</td>
      <td>114452</td>
      <td>111100</td>
      <td>619760</td>
      <td>370211</td>
      <td>0.509524</td>
      <td>0.490476</td>
      <td>0.487221</td>
      <td>0.512777</td>
      <td>50</td>
    </tr>
    <tr>
      <td>1</td>
      <td>28065</td>
      <td>2007/02/19</td>
      <td>2007/08/03</td>
      <td>男</td>
      <td>6</td>
      <td>NaN</td>
      <td>北京</td>
      <td>CN</td>
      <td>42.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12000</td>
      <td>53288</td>
      <td>53288</td>
      <td>415768</td>
      <td>238410</td>
      <td>0.514286</td>
      <td>0.485714</td>
      <td>0.489289</td>
      <td>0.510708</td>
      <td>33</td>
    </tr>
    <tr>
      <td>2</td>
      <td>55106</td>
      <td>2007/02/01</td>
      <td>2007/08/30</td>
      <td>男</td>
      <td>6</td>
      <td>.</td>
      <td>北京</td>
      <td>CN</td>
      <td>40.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>15491</td>
      <td>55202</td>
      <td>51711</td>
      <td>406361</td>
      <td>233798</td>
      <td>0.518519</td>
      <td>0.481481</td>
      <td>0.481467</td>
      <td>0.518530</td>
      <td>26</td>
    </tr>
    <tr>
      <td>3</td>
      <td>21189</td>
      <td>2008/08/22</td>
      <td>2008/08/23</td>
      <td>男</td>
      <td>5</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>US</td>
      <td>64.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>34890</td>
      <td>34890</td>
      <td>372204</td>
      <td>186100</td>
      <td>0.434783</td>
      <td>0.565217</td>
      <td>0.551722</td>
      <td>0.448275</td>
      <td>12</td>
    </tr>
    <tr>
      <td>4</td>
      <td>39546</td>
      <td>2009/04/10</td>
      <td>2009/04/15</td>
      <td>男</td>
      <td>6</td>
      <td>贵阳</td>
      <td>贵州</td>
      <td>CN</td>
      <td>48.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>22704</td>
      <td>64969</td>
      <td>64969</td>
      <td>338813</td>
      <td>210365</td>
      <td>0.532895</td>
      <td>0.467105</td>
      <td>0.469054</td>
      <td>0.530943</td>
      <td>39</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>62982</td>
      <td>16415</td>
      <td>2013/01/20</td>
      <td>2013/01/20</td>
      <td>女</td>
      <td>4</td>
      <td>北京</td>
      <td>.</td>
      <td>CN</td>
      <td>35.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62983</td>
      <td>18375</td>
      <td>2011/05/20</td>
      <td>2013/06/05</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>25.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>12318</td>
      <td>12318</td>
      <td>12123</td>
      <td>12318</td>
      <td>12123</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>22</td>
    </tr>
    <tr>
      <td>62984</td>
      <td>36041</td>
      <td>2010/03/08</td>
      <td>2013/09/14</td>
      <td>男</td>
      <td>4</td>
      <td>佛山</td>
      <td>广东</td>
      <td>CN</td>
      <td>38.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>106972</td>
      <td>106972</td>
      <td>56506</td>
      <td>106972</td>
      <td>56506</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>43</td>
    </tr>
    <tr>
      <td>62985</td>
      <td>45690</td>
      <td>2006/03/30</td>
      <td>2006/12/02</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>43.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <td>62986</td>
      <td>61027</td>
      <td>2013/02/06</td>
      <td>2013/02/14</td>
      <td>女</td>
      <td>4</td>
      <td>广州</td>
      <td>广东</td>
      <td>CN</td>
      <td>36.0</td>
      <td>2014/03/31</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>61883 rows × 44 columns</p>
</div>




```python
data_kmsum.shape
```




    (61883, 44)



# 特征选择

- L：入会时长 R：最近乘坐航班距离样本截止月份数 F：飞行总次数 M：累积飞行总里程 C：平均折扣率 （LRFMC模型）

M 消费金额

- 指客户在某段时间内所消费的金额。消费金额越大的顾客其消费能力自然也就越大，这就是所谓的“20%的客户贡献了80%的销售额”的二八法则。而这批客户也必然是商家在进行营销活动时需要特别照顾的群体，尤其是在商家前期资源不足的时候

- RFM的M消费金额数据，用飞行里程和折扣率两个变量进行替代，考虑到近距离土豪金座位也为高价值用户，低等仓里程多也为高价值

L 加入会员时间至样本截止时间之差 客户关系长度

L= load_count = loadtime - ffpdate

![image.png](attachment:image.png)

![image.png](attachment:image.png)

R（Recency） 最近乘坐航班间隔月份数 消费时间间隔  

- R=Last_to_end


- 指的是最近一次消费时间与截止时间的间隔。通常情况下，客户最近一次消费时间与截止时间的间隔越短，对即时提供的商品或是服务也最有可能感兴趣。这也是为什么消费时间间隔0～6个月的顾客收到的沟通信息多于1年以上的顾客的原因。
- 最近一次消费时间与截止时间的间隔不仅能够为确定促销客户群体提供依据，还能够从中得出企业发展的趋势。如果分析报告显示最近一次消费时间很近的客户在增加，则表示该公司是个稳步上升的公司。反之，最近一次消费时间很近的客户越来越少，则说明该公司需要找到问题所在，及时调整营销策略。

![image.png](attachment:image.png)

F（Frequency）飞行次数 消费频率

F = SEG_KM_UM

指客户在某段时间内所消费的次数。可以说消费频率越高的客户，其满意度越高，其忠诚度也就越高，客户价值也就越大。增加客户购买的次数意味着从竞争对手处“偷取”市场占有率，赚取营业额。商家需要做的是通过各种营销方式，不断地去刺激客户消费，提高他们的消费频率，提升店铺的复购率。

![image.png](attachment:image.png)

M 累积飞行里程 

- M = SEG_KM_UM 




![image.png](attachment:image.png)

C 平均折扣率 折扣系数的平均值

- 客户在观测时间内乘坐舱位所对应的折扣系数的平均值C=平均折扣率

![image.png](attachment:image.png)


```python
data_kmsum.columns
```




    Index(['MEMBER_NO', 'FFP_DATE', 'FIRST_FLIGHT_DATE', 'GENDER', 'FFP_TIER',
           'WORK_CITY', 'WORK_PROVINCE', 'WORK_COUNTRY', 'AGE', 'LOAD_TIME',
           'FLIGHT_COUNT', 'BP_SUM', 'EP_SUM_YR_1', 'EP_SUM_YR_2', 'SUM_YR_1',
           'SUM_YR_2', 'SEG_KM_SUM', 'WEIGHTED_SEG_KM', 'LAST_FLIGHT_DATE',
           'AVG_FLIGHT_COUNT', 'AVG_BP_SUM', 'BEGIN_TO_FIRST', 'LAST_TO_END',
           'AVG_INTERVAL', 'MAX_INTERVAL', 'ADD_POINTS_SUM_YR_1',
           'ADD_POINTS_SUM_YR_2', 'EXCHANGE_COUNT', 'avg_discount',
           'P1Y_Flight_Count', 'L1Y_Flight_Count', 'P1Y_BP_SUM', 'L1Y_BP_SUM',
           'EP_SUM', 'ADD_Point_SUM', 'Eli_Add_Point_Sum', 'L1Y_ELi_Add_Points',
           'Points_Sum', 'L1Y_Points_Sum', 'Ration_L1Y_Flight_Count',
           'Ration_P1Y_Flight_Count', 'Ration_P1Y_BPS', 'Ration_L1Y_BPS',
           'Point_NotFlight'],
          dtype='object')



## L 入会时长
- 会员注册时间，样本截止时间，之差


```python
pd.to_datetime(data_kmsum['LOAD_TIME'])[0]
```




    Timestamp('2014-03-31 00:00:00')




```python
pd.to_datetime(data_kmsum['LOAD_TIME'])[0] - pd.to_datetime(data_kmsum['FFP_DATE'])[0]
```




    Timedelta('2706 days 00:00:00')




```python
(pd.to_datetime(data_kmsum['LOAD_TIME'])[0] - pd.to_datetime(data_kmsum['FFP_DATE'])[0])/30
```




    Timedelta('90 days 04:48:00')




```python
str(pd.to_datetime(data_kmsum['LOAD_TIME'])[0] - pd.to_datetime(data_kmsum['FFP_DATE'])[0]).split(' ')
```




    ['2706', 'days', '00:00:00']




```python
str(pd.to_datetime(data_kmsum['LOAD_TIME'])[0] - pd.to_datetime(data_kmsum['FFP_DATE'])[0]).split(' ')[0]
```




    '2706'




```python
(int(str(pd.to_datetime(data_kmsum['LOAD_TIME'])[0] - pd.to_datetime(data_kmsum['FFP_DATE'])[0]).split(' ')[0]))/30
```




    90.2




```python
data_kmsum['LOAD_TIME'][0:2]
```




    0    2014/03/31
    1    2014/03/31
    Name: LOAD_TIME, dtype: object




```python
pd.to_datetime(data_kmsum['LOAD_TIME'])-pd.to_datetime(data_kmsum['FFP_DATE'])
```




    0       2706 days
    1       2597 days
    2       2615 days
    3       2047 days
    4       1816 days
               ...   
    62982    435 days
    62983   1046 days
    62984   1484 days
    62985   2923 days
    62986    418 days
    Length: 61883, dtype: timedelta64[ns]




```python
L1 = ((pd.to_datetime(data_kmsum['LOAD_TIME']) - pd.to_datetime(data_kmsum['FFP_DATE']))/30)
L1
```




    0       90 days 04:48:00
    1       86 days 13:36:00
    2       87 days 04:00:00
    3       68 days 05:36:00
    4       60 days 12:48:00
                  ...       
    62982   14 days 12:00:00
    62983   34 days 20:48:00
    62984   49 days 11:12:00
    62985   97 days 10:24:00
    62986   13 days 22:24:00
    Length: 61883, dtype: timedelta64[ns]




```python
L1[0:3]
```




    0   90 days 04:48:00
    1   86 days 13:36:00
    2   87 days 04:00:00
    dtype: timedelta64[ns]




```python
for i in L1[0:3]:
    print(str(i).split(' ')[0])
```

    90
    86
    87
    


```python
L = []
for i in L1:
    month = str(i).split(' ')[0]
    # print(month)
    L.append(int(month))
L
# [90,86,87,... ] 得到数值型的月份数据
```


```python
L
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>90</td>
    </tr>
    <tr>
      <td>1</td>
      <td>86</td>
    </tr>
    <tr>
      <td>2</td>
      <td>87</td>
    </tr>
    <tr>
      <td>3</td>
      <td>68</td>
    </tr>
    <tr>
      <td>4</td>
      <td>60</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>61878</td>
      <td>14</td>
    </tr>
    <tr>
      <td>61879</td>
      <td>34</td>
    </tr>
    <tr>
      <td>61880</td>
      <td>49</td>
    </tr>
    <tr>
      <td>61881</td>
      <td>97</td>
    </tr>
    <tr>
      <td>61882</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
<p>61883 rows × 1 columns</p>
</div>




```python
max(L),min(L),len(L)
```




    (114, 12, 61883)




```python
L = pd.DataFrame(L)
L.head(2)
# TypeError: cannot concatenate object of type '<class 'list'>'; only Series and DataFrame objs are valid
# 出现L为series对象，需转换成DataFrame对象后才能进行合并
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>90</td>
    </tr>
    <tr>
      <td>1</td>
      <td>86</td>
    </tr>
  </tbody>
</table>
</div>




```python
L.max(),L.min()
```




    (0    114
     dtype: int64, 0    12
     dtype: int64)




```python
data_kmsum.columns
```




    Index(['MEMBER_NO', 'FFP_DATE', 'FIRST_FLIGHT_DATE', 'GENDER', 'FFP_TIER',
           'WORK_CITY', 'WORK_PROVINCE', 'WORK_COUNTRY', 'AGE', 'LOAD_TIME',
           'FLIGHT_COUNT', 'BP_SUM', 'EP_SUM_YR_1', 'EP_SUM_YR_2', 'SUM_YR_1',
           'SUM_YR_2', 'SEG_KM_SUM', 'WEIGHTED_SEG_KM', 'LAST_FLIGHT_DATE',
           'AVG_FLIGHT_COUNT', 'AVG_BP_SUM', 'BEGIN_TO_FIRST', 'LAST_TO_END',
           'AVG_INTERVAL', 'MAX_INTERVAL', 'ADD_POINTS_SUM_YR_1',
           'ADD_POINTS_SUM_YR_2', 'EXCHANGE_COUNT', 'avg_discount',
           'P1Y_Flight_Count', 'L1Y_Flight_Count', 'P1Y_BP_SUM', 'L1Y_BP_SUM',
           'EP_SUM', 'ADD_Point_SUM', 'Eli_Add_Point_Sum', 'L1Y_ELi_Add_Points',
           'Points_Sum', 'L1Y_Points_Sum', 'Ration_L1Y_Flight_Count',
           'Ration_P1Y_Flight_Count', 'Ration_P1Y_BPS', 'Ration_L1Y_BPS',
           'Point_NotFlight'],
          dtype='object')



## R最近月份数-M公里数-F次数


```python
# str(pd.to_datetime(data_kmsum['LOAD_TIME'])[0] - pd.to_datetime(data_kmsum['FFP_DATE'])[0]).split(' ')[0]
datamodel = data_kmsum[['LAST_TO_END','FLIGHT_COUNT','SEG_KM_SUM','avg_discount','LOAD_TIME','FFP_DATE']]
datamodel
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LAST_TO_END</th>
      <th>FLIGHT_COUNT</th>
      <th>SEG_KM_SUM</th>
      <th>avg_discount</th>
      <th>LOAD_TIME</th>
      <th>FFP_DATE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>210</td>
      <td>580717</td>
      <td>0.961639</td>
      <td>2014/03/31</td>
      <td>2006/11/02</td>
    </tr>
    <tr>
      <td>1</td>
      <td>7</td>
      <td>140</td>
      <td>293678</td>
      <td>1.252314</td>
      <td>2014/03/31</td>
      <td>2007/02/19</td>
    </tr>
    <tr>
      <td>2</td>
      <td>11</td>
      <td>135</td>
      <td>283712</td>
      <td>1.254676</td>
      <td>2014/03/31</td>
      <td>2007/02/01</td>
    </tr>
    <tr>
      <td>3</td>
      <td>97</td>
      <td>23</td>
      <td>281336</td>
      <td>1.090870</td>
      <td>2014/03/31</td>
      <td>2008/08/22</td>
    </tr>
    <tr>
      <td>4</td>
      <td>5</td>
      <td>152</td>
      <td>309928</td>
      <td>0.970658</td>
      <td>2014/03/31</td>
      <td>2009/04/10</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>62982</td>
      <td>437</td>
      <td>2</td>
      <td>3848</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2013/01/20</td>
    </tr>
    <tr>
      <td>62983</td>
      <td>297</td>
      <td>2</td>
      <td>1134</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2011/05/20</td>
    </tr>
    <tr>
      <td>62984</td>
      <td>89</td>
      <td>4</td>
      <td>8016</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2010/03/08</td>
    </tr>
    <tr>
      <td>62985</td>
      <td>29</td>
      <td>2</td>
      <td>2594</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2006/03/30</td>
    </tr>
    <tr>
      <td>62986</td>
      <td>400</td>
      <td>2</td>
      <td>3934</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2013/02/06</td>
    </tr>
  </tbody>
</table>
<p>61883 rows × 6 columns</p>
</div>




```python
datamodel = datamodel.reset_index()
datamodel
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>level_0</th>
      <th>index</th>
      <th>LAST_TO_END</th>
      <th>FLIGHT_COUNT</th>
      <th>SEG_KM_SUM</th>
      <th>avg_discount</th>
      <th>LOAD_TIME</th>
      <th>FFP_DATE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>210</td>
      <td>580717</td>
      <td>0.961639</td>
      <td>2014/03/31</td>
      <td>2006/11/02</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>140</td>
      <td>293678</td>
      <td>1.252314</td>
      <td>2014/03/31</td>
      <td>2007/02/19</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>11</td>
      <td>135</td>
      <td>283712</td>
      <td>1.254676</td>
      <td>2014/03/31</td>
      <td>2007/02/01</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>97</td>
      <td>23</td>
      <td>281336</td>
      <td>1.090870</td>
      <td>2014/03/31</td>
      <td>2008/08/22</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>5</td>
      <td>152</td>
      <td>309928</td>
      <td>0.970658</td>
      <td>2014/03/31</td>
      <td>2009/04/10</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>61878</td>
      <td>61878</td>
      <td>62982</td>
      <td>437</td>
      <td>2</td>
      <td>3848</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2013/01/20</td>
    </tr>
    <tr>
      <td>61879</td>
      <td>61879</td>
      <td>62983</td>
      <td>297</td>
      <td>2</td>
      <td>1134</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2011/05/20</td>
    </tr>
    <tr>
      <td>61880</td>
      <td>61880</td>
      <td>62984</td>
      <td>89</td>
      <td>4</td>
      <td>8016</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2010/03/08</td>
    </tr>
    <tr>
      <td>61881</td>
      <td>61881</td>
      <td>62985</td>
      <td>29</td>
      <td>2</td>
      <td>2594</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2006/03/30</td>
    </tr>
    <tr>
      <td>61882</td>
      <td>61882</td>
      <td>62986</td>
      <td>400</td>
      <td>2</td>
      <td>3934</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2013/02/06</td>
    </tr>
  </tbody>
</table>
<p>61883 rows × 8 columns</p>
</div>




```python
datamodel = pd.concat([datamodel,L],axis=1)
datamodel
# L为已经索引OK的结果，datamodel也需要重置所以让结合的两个DataFrame索引一致才行
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>level_0</th>
      <th>index</th>
      <th>LAST_TO_END</th>
      <th>FLIGHT_COUNT</th>
      <th>SEG_KM_SUM</th>
      <th>avg_discount</th>
      <th>LOAD_TIME</th>
      <th>FFP_DATE</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>210</td>
      <td>580717</td>
      <td>0.961639</td>
      <td>2014/03/31</td>
      <td>2006/11/02</td>
      <td>90</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>140</td>
      <td>293678</td>
      <td>1.252314</td>
      <td>2014/03/31</td>
      <td>2007/02/19</td>
      <td>86</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>11</td>
      <td>135</td>
      <td>283712</td>
      <td>1.254676</td>
      <td>2014/03/31</td>
      <td>2007/02/01</td>
      <td>87</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>97</td>
      <td>23</td>
      <td>281336</td>
      <td>1.090870</td>
      <td>2014/03/31</td>
      <td>2008/08/22</td>
      <td>68</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>5</td>
      <td>152</td>
      <td>309928</td>
      <td>0.970658</td>
      <td>2014/03/31</td>
      <td>2009/04/10</td>
      <td>60</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>61878</td>
      <td>61878</td>
      <td>62982</td>
      <td>437</td>
      <td>2</td>
      <td>3848</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2013/01/20</td>
      <td>14</td>
    </tr>
    <tr>
      <td>61879</td>
      <td>61879</td>
      <td>62983</td>
      <td>297</td>
      <td>2</td>
      <td>1134</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2011/05/20</td>
      <td>34</td>
    </tr>
    <tr>
      <td>61880</td>
      <td>61880</td>
      <td>62984</td>
      <td>89</td>
      <td>4</td>
      <td>8016</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2010/03/08</td>
      <td>49</td>
    </tr>
    <tr>
      <td>61881</td>
      <td>61881</td>
      <td>62985</td>
      <td>29</td>
      <td>2</td>
      <td>2594</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2006/03/30</td>
      <td>97</td>
    </tr>
    <tr>
      <td>61882</td>
      <td>61882</td>
      <td>62986</td>
      <td>400</td>
      <td>2</td>
      <td>3934</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2013/02/06</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
<p>61883 rows × 9 columns</p>
</div>




```python
del datamodel['index']
```


```python
del datamodel['level_0']
```


```python
datamodel
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LAST_TO_END</th>
      <th>FLIGHT_COUNT</th>
      <th>SEG_KM_SUM</th>
      <th>avg_discount</th>
      <th>LOAD_TIME</th>
      <th>FFP_DATE</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>210</td>
      <td>580717</td>
      <td>0.961639</td>
      <td>2014/03/31</td>
      <td>2006/11/02</td>
      <td>90</td>
    </tr>
    <tr>
      <td>1</td>
      <td>7</td>
      <td>140</td>
      <td>293678</td>
      <td>1.252314</td>
      <td>2014/03/31</td>
      <td>2007/02/19</td>
      <td>86</td>
    </tr>
    <tr>
      <td>2</td>
      <td>11</td>
      <td>135</td>
      <td>283712</td>
      <td>1.254676</td>
      <td>2014/03/31</td>
      <td>2007/02/01</td>
      <td>87</td>
    </tr>
    <tr>
      <td>3</td>
      <td>97</td>
      <td>23</td>
      <td>281336</td>
      <td>1.090870</td>
      <td>2014/03/31</td>
      <td>2008/08/22</td>
      <td>68</td>
    </tr>
    <tr>
      <td>4</td>
      <td>5</td>
      <td>152</td>
      <td>309928</td>
      <td>0.970658</td>
      <td>2014/03/31</td>
      <td>2009/04/10</td>
      <td>60</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>61878</td>
      <td>437</td>
      <td>2</td>
      <td>3848</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2013/01/20</td>
      <td>14</td>
    </tr>
    <tr>
      <td>61879</td>
      <td>297</td>
      <td>2</td>
      <td>1134</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2011/05/20</td>
      <td>34</td>
    </tr>
    <tr>
      <td>61880</td>
      <td>89</td>
      <td>4</td>
      <td>8016</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2010/03/08</td>
      <td>49</td>
    </tr>
    <tr>
      <td>61881</td>
      <td>29</td>
      <td>2</td>
      <td>2594</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2006/03/30</td>
      <td>97</td>
    </tr>
    <tr>
      <td>61882</td>
      <td>400</td>
      <td>2</td>
      <td>3934</td>
      <td>0.000000</td>
      <td>2014/03/31</td>
      <td>2013/02/06</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
<p>61883 rows × 7 columns</p>
</div>




```python
columns = {'LAST_TO_END':'R','FLIGHT_COUNT':'F','SEG_KM_SUM':'M','avg_discount':'C','0':'L'}
columns
```




    {'LAST_TO_END': 'R',
     'FLIGHT_COUNT': 'F',
     'SEG_KM_SUM': 'M',
     'avg_discount': 'C',
     '0': 'L'}




```python
datamodel.rename(columns=columns,inplace=True)
```


```python
del datamodel['LOAD_TIME']
```


```python
del datamodel['FFP_DATE']
```


```python
datamodel.rename(columns={0:'L'},inplace=True)
```


```python
datamodel.max()
```




    R       731.0
    F       213.0
    M    580717.0
    C         1.5
    L       114.0
    dtype: float64




```python
datamodel.min()
```




    R      1.0
    F      2.0
    M    368.0
    C      0.0
    L     12.0
    dtype: float64




```python
datamodel.R.max(),datamodel.R.min(),datamodel.R.max()/30,datamodel.R.min()/30
```




    (731, 1, 24.366666666666667, 0.03333333333333333)




```python
datamodel.R = ((datamodel.R)/30).map(lambda x:round(x,2))    
datamodel.R
```




    0         0.03
    1         0.23
    2         0.37
    3         3.23
    4         0.17
             ...  
    61878    14.57
    61879     9.90
    61880     2.97
    61881     0.97
    61882    13.33
    Name: R, Length: 61883, dtype: float64




```python
datamodel
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>C</th>
      <th>L</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.03</td>
      <td>210</td>
      <td>580717</td>
      <td>0.961639</td>
      <td>90</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.23</td>
      <td>140</td>
      <td>293678</td>
      <td>1.252314</td>
      <td>86</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.37</td>
      <td>135</td>
      <td>283712</td>
      <td>1.254676</td>
      <td>87</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3.23</td>
      <td>23</td>
      <td>281336</td>
      <td>1.090870</td>
      <td>68</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.17</td>
      <td>152</td>
      <td>309928</td>
      <td>0.970658</td>
      <td>60</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>61878</td>
      <td>14.57</td>
      <td>2</td>
      <td>3848</td>
      <td>0.000000</td>
      <td>14</td>
    </tr>
    <tr>
      <td>61879</td>
      <td>9.90</td>
      <td>2</td>
      <td>1134</td>
      <td>0.000000</td>
      <td>34</td>
    </tr>
    <tr>
      <td>61880</td>
      <td>2.97</td>
      <td>4</td>
      <td>8016</td>
      <td>0.000000</td>
      <td>49</td>
    </tr>
    <tr>
      <td>61881</td>
      <td>0.97</td>
      <td>2</td>
      <td>2594</td>
      <td>0.000000</td>
      <td>97</td>
    </tr>
    <tr>
      <td>61882</td>
      <td>13.33</td>
      <td>2</td>
      <td>3934</td>
      <td>0.000000</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
<p>61883 rows × 5 columns</p>
</div>



## C 平均折扣


```python
datamodel = datamodel[datamodel['C'].values != 0]
datamodel
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>C</th>
      <th>L</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.03</td>
      <td>210</td>
      <td>580717</td>
      <td>0.961639</td>
      <td>90</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.23</td>
      <td>140</td>
      <td>293678</td>
      <td>1.252314</td>
      <td>86</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.37</td>
      <td>135</td>
      <td>283712</td>
      <td>1.254676</td>
      <td>87</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3.23</td>
      <td>23</td>
      <td>281336</td>
      <td>1.090870</td>
      <td>68</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.17</td>
      <td>152</td>
      <td>309928</td>
      <td>0.970658</td>
      <td>60</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>61871</td>
      <td>2.97</td>
      <td>2</td>
      <td>368</td>
      <td>0.710000</td>
      <td>108</td>
    </tr>
    <tr>
      <td>61872</td>
      <td>4.03</td>
      <td>2</td>
      <td>368</td>
      <td>0.670000</td>
      <td>65</td>
    </tr>
    <tr>
      <td>61873</td>
      <td>1.30</td>
      <td>2</td>
      <td>1062</td>
      <td>0.225000</td>
      <td>45</td>
    </tr>
    <tr>
      <td>61874</td>
      <td>15.47</td>
      <td>2</td>
      <td>904</td>
      <td>0.250000</td>
      <td>15</td>
    </tr>
    <tr>
      <td>61875</td>
      <td>9.40</td>
      <td>2</td>
      <td>760</td>
      <td>0.280000</td>
      <td>36</td>
    </tr>
  </tbody>
</table>
<p>61876 rows × 5 columns</p>
</div>




```python
datamodel.C.max(),datamodel.C.min()
```




    (1.5, 0.112043302)




```python
datamodel.C = datamodel.C.map(lambda x:round(x,2))    
datamodel.C
```




    0        0.96
    1        1.25
    2        1.25
    3        1.09
    4        0.97
             ... 
    61871    0.71
    61872    0.67
    61873    0.23
    61874    0.25
    61875    0.28
    Name: C, Length: 61876, dtype: float64




```python
datamodel.C.max(),datamodel.C.min()
```




    (1.5, 0.11)



## L R F M C


```python
datamodel
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>C</th>
      <th>L</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.03</td>
      <td>210</td>
      <td>580717</td>
      <td>0.96</td>
      <td>90</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.23</td>
      <td>140</td>
      <td>293678</td>
      <td>1.25</td>
      <td>86</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.37</td>
      <td>135</td>
      <td>283712</td>
      <td>1.25</td>
      <td>87</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3.23</td>
      <td>23</td>
      <td>281336</td>
      <td>1.09</td>
      <td>68</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.17</td>
      <td>152</td>
      <td>309928</td>
      <td>0.97</td>
      <td>60</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>61871</td>
      <td>2.97</td>
      <td>2</td>
      <td>368</td>
      <td>0.71</td>
      <td>108</td>
    </tr>
    <tr>
      <td>61872</td>
      <td>4.03</td>
      <td>2</td>
      <td>368</td>
      <td>0.67</td>
      <td>65</td>
    </tr>
    <tr>
      <td>61873</td>
      <td>1.30</td>
      <td>2</td>
      <td>1062</td>
      <td>0.23</td>
      <td>45</td>
    </tr>
    <tr>
      <td>61874</td>
      <td>15.47</td>
      <td>2</td>
      <td>904</td>
      <td>0.25</td>
      <td>15</td>
    </tr>
    <tr>
      <td>61875</td>
      <td>9.40</td>
      <td>2</td>
      <td>760</td>
      <td>0.28</td>
      <td>36</td>
    </tr>
  </tbody>
</table>
<p>61876 rows × 5 columns</p>
</div>




```python
datamodel = datamodel[['L','R','F','M','C']]
datamodel
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>L</th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>90</td>
      <td>0.03</td>
      <td>210</td>
      <td>580717</td>
      <td>0.96</td>
    </tr>
    <tr>
      <td>1</td>
      <td>86</td>
      <td>0.23</td>
      <td>140</td>
      <td>293678</td>
      <td>1.25</td>
    </tr>
    <tr>
      <td>2</td>
      <td>87</td>
      <td>0.37</td>
      <td>135</td>
      <td>283712</td>
      <td>1.25</td>
    </tr>
    <tr>
      <td>3</td>
      <td>68</td>
      <td>3.23</td>
      <td>23</td>
      <td>281336</td>
      <td>1.09</td>
    </tr>
    <tr>
      <td>4</td>
      <td>60</td>
      <td>0.17</td>
      <td>152</td>
      <td>309928</td>
      <td>0.97</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>61871</td>
      <td>108</td>
      <td>2.97</td>
      <td>2</td>
      <td>368</td>
      <td>0.71</td>
    </tr>
    <tr>
      <td>61872</td>
      <td>65</td>
      <td>4.03</td>
      <td>2</td>
      <td>368</td>
      <td>0.67</td>
    </tr>
    <tr>
      <td>61873</td>
      <td>45</td>
      <td>1.30</td>
      <td>2</td>
      <td>1062</td>
      <td>0.23</td>
    </tr>
    <tr>
      <td>61874</td>
      <td>15</td>
      <td>15.47</td>
      <td>2</td>
      <td>904</td>
      <td>0.25</td>
    </tr>
    <tr>
      <td>61875</td>
      <td>36</td>
      <td>9.40</td>
      <td>2</td>
      <td>760</td>
      <td>0.28</td>
    </tr>
  </tbody>
</table>
<p>61876 rows × 5 columns</p>
</div>




```python
maxminmodel = pd.concat([pd.DataFrame(datamodel.max()),pd.DataFrame(datamodel.min())],axis=1)
# maxminmodel.rename(columns={0:'最大值',0:'最小值'},inplace=True)
# 此代码改动后会导致失效，因为两个列都是0
# 以下代码参考进行左到右进行修改
maxminmodel.columns = ['最大值','最小值']
maxminmodel = maxminmodel.T
maxminmodel
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>C</th>
      <th>L</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>最大值</td>
      <td>24.37</td>
      <td>213.0</td>
      <td>580717.0</td>
      <td>1.50</td>
      <td>114.0</td>
    </tr>
    <tr>
      <td>最小值</td>
      <td>0.03</td>
      <td>2.0</td>
      <td>368.0</td>
      <td>0.11</td>
      <td>12.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
maxminmodel = maxminmodel[['L','R','F','M','C']]
maxminmodel
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>L</th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>最大值</td>
      <td>114.0</td>
      <td>24.37</td>
      <td>213.0</td>
      <td>580717.0</td>
      <td>1.50</td>
    </tr>
    <tr>
      <td>最小值</td>
      <td>12.0</td>
      <td>0.03</td>
      <td>2.0</td>
      <td>368.0</td>
      <td>0.11</td>
    </tr>
  </tbody>
</table>
</div>



# 标准化处理

- 标准化公式：(x-μ)/δ
- 每个值减去均值后，再除以，标准差


```python
from sklearn.preprocessing import StandardScaler
```


```python
DataModelScaler = StandardScaler().fit_transform(datamodel)
DataModelScaler
```




    array([[ 1.45247832, -0.94741492, 14.0304266 , 26.77658134,  1.28959815],
           [ 1.31084759, -0.91430847,  9.07106694, 13.13485424,  2.85936236],
           [ 1.34625527, -0.89113395,  8.71682697, 12.6612132 ,  2.85936236],
           ...,
           [-0.14086736, -0.73718895, -0.70595637, -0.77192363, -2.66187729],
           [-1.20309782,  1.60840313, -0.70595637, -0.77943269, -2.55361769],
           [-0.4595365 ,  0.60362233, -0.70595637, -0.78627639, -2.39122829]])




```python
zscoreddata = r"E:\Study\github\MachineLearning\航空公司客户分析\zscoreddata.xls"
pd.to_excel(zscoreddata,DataModelScaler)

# 保存已经标准化后的数据集到指定的文档保存
```

# 构建Kmenas聚类模型

## 已标准化数据导入


```python
from sklearn.cluster import KMeans
import numpy as np
import pandas as pd
```


```python
zscoreddata = r"E:\Study\github\MachineLearning\航空公司客户分析\zscoreddata.xls"
DataModelScaler = pd.read_excel(zscoreddata)
DataModelScaler
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ZL</th>
      <th>ZR</th>
      <th>ZF</th>
      <th>ZM</th>
      <th>ZC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.689882</td>
      <td>0.140299</td>
      <td>-0.635788</td>
      <td>0.068794</td>
      <td>-0.337186</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.689882</td>
      <td>-0.322442</td>
      <td>0.852453</td>
      <td>0.843848</td>
      <td>-0.553613</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1.681743</td>
      <td>-0.487707</td>
      <td>-0.210576</td>
      <td>0.158569</td>
      <td>-1.094680</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1.534185</td>
      <td>-0.785184</td>
      <td>0.002030</td>
      <td>0.273091</td>
      <td>-1.148787</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.890167</td>
      <td>-0.426559</td>
      <td>-0.635788</td>
      <td>-0.685170</td>
      <td>1.231909</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>62039</td>
      <td>0.590805</td>
      <td>-0.938881</td>
      <td>1.986351</td>
      <td>2.694820</td>
      <td>-0.499506</td>
    </tr>
    <tr>
      <td>62040</td>
      <td>0.578774</td>
      <td>-0.086114</td>
      <td>0.072898</td>
      <td>0.163414</td>
      <td>0.366201</td>
    </tr>
    <tr>
      <td>62041</td>
      <td>0.592928</td>
      <td>-0.796753</td>
      <td>0.710716</td>
      <td>1.607265</td>
      <td>-0.932360</td>
    </tr>
    <tr>
      <td>62042</td>
      <td>0.575235</td>
      <td>-0.211715</td>
      <td>-0.423182</td>
      <td>-0.187230</td>
      <td>-0.661826</td>
    </tr>
    <tr>
      <td>62043</td>
      <td>0.529234</td>
      <td>-0.376980</td>
      <td>0.143767</td>
      <td>0.616752</td>
      <td>0.041561</td>
    </tr>
  </tbody>
</table>
<p>62044 rows × 5 columns</p>
</div>



## SSE误差平方和可视化图


```python
import matplotlib.pyplot as plt
import seaborn as sns

sse = []

for k in range(1,10):
    
    km = KMeans(n_clusters=k,random_state=123)
    km.fit(DataModelScaler)
    # inertia_: 表示每一个样本点到自己的聚类中心的距离的平方和的和。越小表示聚类效果越好
    sse.append(km.inertia_)

sse
```




    [310214.99999990873,
     229350.83303042967,
     184347.97987024716,
     151006.63605683498,
     133359.04482864714,
     118064.12401253801,
     107628.13923584919,
     100709.1478004867,
     93864.11772690751]




```python
plt.plot(range(1,10),sse,marker='o')
plt.show
```




    <function matplotlib.pyplot.show(*args, **kw)>




![png](output_168_1.png)


## n_clusters 确定簇心个数

- 正常簇心以选择3-5个点为准
- 结合模型LRFMC5个向量
- 结合以上下滑曲线，5之后平滑缓慢点出现
- 最终决定选择n_clusters=5


```python
# 簇心个数为5，随机状态为123，并发数为4
n_clusters = 5
random_state = 123
n_jobs = 4 
```


```python
KmeansData = KMeans(n_clusters=n_clusters,n_jobs=n_jobs,random_state=random_state).fit(DataModelScaler)
KmeansData
```




    KMeans(algorithm='auto', copy_x=True, init='k-means++', max_iter=300,
           n_clusters=5, n_init=10, n_jobs=4, precompute_distances='auto',
           random_state=123, tol=0.0001, verbose=0)



## labels_ 行数据簇标签


```python
KmeansData.labels_
# 获取每行数据对应的聚类标签值
```




    array([4, 4, 4, ..., 4, 4, 4])




```python
pd.Series(KmeansData.labels_).value_counts()
# 查询所有数据的簇心对应的数量
```




    0    24593
    4    15723
    2    12107
    1     5341
    3     4280
    dtype: int64




```python
pd.Series(KmeansData.labels_).value_counts().sort_index()
```




    0    24593
    1     5341
    2    12107
    3     4280
    4    15723
    dtype: int64



## cluster_centers_ 簇心


```python
KmeansData.cluster_centers_
# 聚类的簇心结果数据，5个簇心，5个标签，对应5x5的矩阵
# 每个簇心对应的五维的簇心值
```




    array([[-7.00842430e-01, -4.15152444e-01, -1.60325121e-01,
            -1.59939040e-01, -2.58984327e-01],
           [ 4.83577840e-01, -7.99800530e-01,  2.48260379e+00,
             2.42340309e+00,  3.10271245e-01],
           [-3.13221317e-01,  1.68738494e+00, -5.73873656e-01,
            -5.36725256e-01, -1.74226375e-01],
           [ 4.46922976e-02, -2.18557907e-03, -2.34791190e-01,
            -2.39017592e-01,  2.16150717e+00],
           [ 1.16085493e+00, -3.77589921e-01, -8.67296553e-02,
            -9.46604409e-02, -1.58761836e-01]])




```python
cluster_center = pd.DataFrame(KmeansData.cluster_centers_,columns=['ZL','ZR','ZM','ZF','ZC'])
cluster_center
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ZL</th>
      <th>ZR</th>
      <th>ZM</th>
      <th>ZF</th>
      <th>ZC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>-0.700842</td>
      <td>-0.415152</td>
      <td>-0.160325</td>
      <td>-0.159939</td>
      <td>-0.258984</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.483578</td>
      <td>-0.799801</td>
      <td>2.482604</td>
      <td>2.423403</td>
      <td>0.310271</td>
    </tr>
    <tr>
      <td>2</td>
      <td>-0.313221</td>
      <td>1.687385</td>
      <td>-0.573874</td>
      <td>-0.536725</td>
      <td>-0.174226</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.044692</td>
      <td>-0.002186</td>
      <td>-0.234791</td>
      <td>-0.239018</td>
      <td>2.161507</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.160855</td>
      <td>-0.377590</td>
      <td>-0.086730</td>
      <td>-0.094660</td>
      <td>-0.158762</td>
    </tr>
  </tbody>
</table>
</div>




```python
cluster_center.index = pd.DataFrame(KmeansData.labels_).drop_duplicates().iloc[:,0]
cluster_center
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ZL</th>
      <th>ZR</th>
      <th>ZM</th>
      <th>ZF</th>
      <th>ZC</th>
    </tr>
    <tr>
      <th>0</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>4</td>
      <td>-0.700842</td>
      <td>-0.415152</td>
      <td>-0.160325</td>
      <td>-0.159939</td>
      <td>-0.258984</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.483578</td>
      <td>-0.799801</td>
      <td>2.482604</td>
      <td>2.423403</td>
      <td>0.310271</td>
    </tr>
    <tr>
      <td>0</td>
      <td>-0.313221</td>
      <td>1.687385</td>
      <td>-0.573874</td>
      <td>-0.536725</td>
      <td>-0.174226</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.044692</td>
      <td>-0.002186</td>
      <td>-0.234791</td>
      <td>-0.239018</td>
      <td>2.161507</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.160855</td>
      <td>-0.377590</td>
      <td>-0.086730</td>
      <td>-0.094660</td>
      <td>-0.158762</td>
    </tr>
  </tbody>
</table>
</div>




```python
pd.DataFrame(KmeansData.labels_).drop_duplicates()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0</td>
    </tr>
    <tr>
      <td>6</td>
      <td>2</td>
    </tr>
    <tr>
      <td>9</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



## 分簇-簇内个数-簇心坐标


```python
r1 = pd.Series(KmeansData.labels_).value_counts() #统计各个类频数
r2 = pd.DataFrame(KmeansData.cluster_centers_)
r = pd.concat([r2,r1], axis = 1)
r.columns =  list(cluster_center.columns) + ['聚类个数']
r = r[['聚类个数','ZL','ZR','ZM','ZF','ZC']]
r
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>聚类个数</th>
      <th>ZL</th>
      <th>ZR</th>
      <th>ZM</th>
      <th>ZF</th>
      <th>ZC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>24593</td>
      <td>-0.700842</td>
      <td>-0.415152</td>
      <td>-0.160325</td>
      <td>-0.159939</td>
      <td>-0.258984</td>
    </tr>
    <tr>
      <td>1</td>
      <td>5341</td>
      <td>0.483578</td>
      <td>-0.799801</td>
      <td>2.482604</td>
      <td>2.423403</td>
      <td>0.310271</td>
    </tr>
    <tr>
      <td>2</td>
      <td>12107</td>
      <td>-0.313221</td>
      <td>1.687385</td>
      <td>-0.573874</td>
      <td>-0.536725</td>
      <td>-0.174226</td>
    </tr>
    <tr>
      <td>3</td>
      <td>4280</td>
      <td>0.044692</td>
      <td>-0.002186</td>
      <td>-0.234791</td>
      <td>-0.239018</td>
      <td>2.161507</td>
    </tr>
    <tr>
      <td>4</td>
      <td>15723</td>
      <td>1.160855</td>
      <td>-0.377590</td>
      <td>-0.086730</td>
      <td>-0.094660</td>
      <td>-0.158762</td>
    </tr>
  </tbody>
</table>
</div>



# 绘制客户分群聚类雷达图


```python
r1 = pd.Series(KmeansData.labels_).value_counts()  # 统计各个类别的数目
r1
```




    0    24593
    4    15723
    2    12107
    1     5341
    3     4280
    dtype: int64




```python
r2 = pd.DataFrame(KmeansData.cluster_centers_)  # 找出聚类中心
r2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>-0.700842</td>
      <td>-0.415152</td>
      <td>-0.160325</td>
      <td>-0.159939</td>
      <td>-0.258984</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.483578</td>
      <td>-0.799801</td>
      <td>2.482604</td>
      <td>2.423403</td>
      <td>0.310271</td>
    </tr>
    <tr>
      <td>2</td>
      <td>-0.313221</td>
      <td>1.687385</td>
      <td>-0.573874</td>
      <td>-0.536725</td>
      <td>-0.174226</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.044692</td>
      <td>-0.002186</td>
      <td>-0.234791</td>
      <td>-0.239018</td>
      <td>2.161507</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.160855</td>
      <td>-0.377590</td>
      <td>-0.086730</td>
      <td>-0.094660</td>
      <td>-0.158762</td>
    </tr>
  </tbody>
</table>
</div>




```python
max = r2.values.max()
max
```




    2.4826037880569594




```python
min = r2.values.min()
min
```




    -0.7998005297618714




```python
r = pd.concat([r2, r1], axis=1)  
# 横向连接（0是纵向），得到聚类中心对应的类别下的数目
r
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>-0.700842</td>
      <td>-0.415152</td>
      <td>-0.160325</td>
      <td>-0.159939</td>
      <td>-0.258984</td>
      <td>24593</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.483578</td>
      <td>-0.799801</td>
      <td>2.482604</td>
      <td>2.423403</td>
      <td>0.310271</td>
      <td>5341</td>
    </tr>
    <tr>
      <td>2</td>
      <td>-0.313221</td>
      <td>1.687385</td>
      <td>-0.573874</td>
      <td>-0.536725</td>
      <td>-0.174226</td>
      <td>12107</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.044692</td>
      <td>-0.002186</td>
      <td>-0.234791</td>
      <td>-0.239018</td>
      <td>2.161507</td>
      <td>4280</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.160855</td>
      <td>-0.377590</td>
      <td>-0.086730</td>
      <td>-0.094660</td>
      <td>-0.158762</td>
      <td>15723</td>
    </tr>
  </tbody>
</table>
</div>




```python
r.columns = list(cluster_center.columns) + [u'类别数目']  # 重命名表头
r
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ZL</th>
      <th>ZR</th>
      <th>ZM</th>
      <th>ZF</th>
      <th>ZC</th>
      <th>类别数目</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>-0.700842</td>
      <td>-0.415152</td>
      <td>-0.160325</td>
      <td>-0.159939</td>
      <td>-0.258984</td>
      <td>24593</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.483578</td>
      <td>-0.799801</td>
      <td>2.482604</td>
      <td>2.423403</td>
      <td>0.310271</td>
      <td>5341</td>
    </tr>
    <tr>
      <td>2</td>
      <td>-0.313221</td>
      <td>1.687385</td>
      <td>-0.573874</td>
      <td>-0.536725</td>
      <td>-0.174226</td>
      <td>12107</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.044692</td>
      <td>-0.002186</td>
      <td>-0.234791</td>
      <td>-0.239018</td>
      <td>2.161507</td>
      <td>4280</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.160855</td>
      <td>-0.377590</td>
      <td>-0.086730</td>
      <td>-0.094660</td>
      <td>-0.158762</td>
      <td>15723</td>
    </tr>
  </tbody>
</table>
</div>




```python
r.values
```




    array([[-7.00842430e-01, -4.15152444e-01, -1.60325121e-01,
            -1.59939040e-01, -2.58984327e-01,  2.45930000e+04],
           [ 4.83577840e-01, -7.99800530e-01,  2.48260379e+00,
             2.42340309e+00,  3.10271245e-01,  5.34100000e+03],
           [-3.13221317e-01,  1.68738494e+00, -5.73873656e-01,
            -5.36725256e-01, -1.74226375e-01,  1.21070000e+04],
           [ 4.46922976e-02, -2.18557907e-03, -2.34791190e-01,
            -2.39017592e-01,  2.16150717e+00,  4.28000000e+03],
           [ 1.16085493e+00, -3.77589921e-01, -8.67296553e-02,
            -9.46604409e-02, -1.58761836e-01,  1.57230000e+04]])




```python
# 绘图
fig = plt.figure(figsize=(10, 8))
ax = fig.add_subplot(111, polar=True)
center_num = r.values
feature = ["L", 'R',"F", "M", "C"]

N = len(feature)

for i, v in enumerate(center_num):
    # 设置雷达图的角度，用于平分切开一个圆面
    angles = np.linspace(0, 2 * np.pi, N, endpoint=False)
    # 为了使雷达图一圈封闭起来，需要下面的步骤
    center = np.concatenate((v[:-1], [v[0]]))
    angles = np.concatenate((angles, [angles[0]]))
    # 绘制折线图
    ax.plot(angles, center, 'o-', linewidth=2, label="Group %d,Num %d" % (i + 1, v[-1]))
     # 填充颜色
    ax.fill(angles, center, alpha=0.25)
     # 添加每个特征的标签
    ax.set_thetagrids(angles * 180 / np.pi, feature, fontsize=15)
    # 设置雷达图的范围
    ax.set_ylim(min - 0.1, max + 0.1)
    # 添加标题
    #plt.title('客户群特征分析图', fontsize=20)
    # 添加网格线
    ax.grid(True)
    # 设置图例
    plt.legend(loc='upper right', bbox_to_anchor=(1.3, 1.0), 
               ncol=1, fancybox=True, shadow=True)

# 显示图形
plt.show()
```


![png](output_191_0.png)


# 数据分析模型结论

## 客户群特征


- 特征C处的值最大，在特征F、M处的值较小，说明客户群是偏好乘坐高级舱位的客户群

- 特征F和M上的值最大，且在特征R上的值最小，说明客户群会员频繁乘机且近期都有乘机记录

- 特征R处的值最大，在特征L、F、M和C处的值都较小，说明客户群已经很久没有乘机，是入会时间较短的低价值群体

- 所有特征上的值都很小，且在特征L处的值最小，说明客户群4属于新入会员较多的客户群

- 特征L处的值最大，在特征R处的值较小，其他特征值都比较适中，说明客户群入会时间较长，飞行频率也较高，是有较高价值的客户群

## 客户群分类

- 重要保持客户、重要发展客户、重要挽留客户、一般客户与低价值客户
- 重要发展客户、重要保持客户、重要挽留客户这3类重要客户分别可以归入客户生命周期管理的发展期、稳定期、衰退期3个阶段

## 重要保持客户（1类）

- 客户的平均折扣系数（C）较高（一般所乘航班的舱位等级较高）
- 最近乘机距今的时间长度（R）低
- 飞行次数（F）或总飞行里程（M）较高
- 为航空公司的高价值客户，是最为理想的客户类型，对航空公司的贡献最大，所占比例却较小
- 航空公司应该优先将资源投放到他们身上，对他们进行差异化管理和一对一营销，提高这类客户的忠诚度与满意度重要保持客户

## 重要发展客户（2类）

- 客户的平均折扣系数（C）较高
- 最近乘机距今的时间长度（R）低
- 飞行次数（F）或总飞行里程（M）较低
- 客户入会时间（L）短
- 为航空公司的潜在价值客户，虽然这类客户的当前价值并不是很高，但却有很大的发展潜力
- 航空公司要努力促使这类客户增加在本公司的乘机消费和合作伙伴处的消费，也就是增加客户的钱包份额
- 通过客户价值的提升，加强这类客户的满意度，提高他们转向竞争对手的转移成本，使他们逐渐成为公司的忠诚客户。


## 重要挽留客户（3类）

- 客户过去所乘航班的平均折扣系数（C）、飞行次数（F）或者总飞行里程（M）较高
- 最近乘机距今的时间长度（R）高或者说乘坐频率变小
- 客户价值变化的不确定性很高
- 客户价值衰退的原因各不相同，所以掌握客户的最新信息、维持与客户的互动就显得尤为重要
- 航空公司应该根据这些客户的最近消费时间以及消费次数的变化情况推测客户消费的异动状况
- 并列出客户名单，对其重点联系，采取一定的营销手段，延长客户的生命周期。

## 一般低价值客户（45类）

- 客户所乘航班的平均折扣系数（C）很低
- 最近乘机距今的时间长度（R）高
- 飞行次数（F）或总飞行里程（M）较低
- 入会时间（L）短
- 他们是航空公司的一般客户与低价值客户，可能是在航空公司机票打折促销时，才会乘坐本公司航班。

## 会员的升级与保级

- 精英会员要求在一定时间内（如一年）积累一定的飞行里程或航段，达到这种要求后就会在有效期内（通常为两年）成为精英会员，并享受相应的高级别服务。有效期快结束时，根据相关评价方法确定客户是否有资格继续作为精英会员，然后对该客户进行相应的升级或降级


- 客户并没有意识到或根本不了解会员升级或保级的时间与要求，经常在评价期过后才发现自己其实只差一点就可以实现升级或保级，却错过了机会，使之前的里程积累白白损失。同时，这种认知还可能导致客户的不满，甚至放弃在本公司的消费


## 首次兑换

- 从数据库中提取出接近但尚未达到首次兑换标准的会员信息，对他们进行适当提醒或采取一些促销活动，使他们通过消费达到兑换标准。一旦实现了首次兑换，客户在本公司进行再次消费兑换就比在其他公司进行首次兑换要容易许多，等于在一定程度上提高了转移的成本。另外，在一些特殊的时间点（如里程折半的时间点）之前可以给客户一些提醒，这样可以增加客户的满意度


- 客户可以通过消费积累的里程来兑换免票或免费升舱等。每个航空公司都有一个首次兑换标准，当客户的里程或航段积累到一定程度时才可以实现第一次兑换，这个标准会高于正常的里程兑换标准。但是很多航空公司的里程积累随着时间的推移进行一定的削减，例如，有的航空公司会在年末对该年积累的里程进行折半处理。这样会导致许多不了解情况的会员白白损失自己好不容易积累的里程，甚至总是难以实现首次兑换。同时，这也会引起客户的不满或流失

## 交叉销售


- 争取新客户的成本远远高于维持老客户成本，客户流失会造成公司收益的直接损失，应该努力维系客户关系水平，使之处于较高的水准，使生命周期内公司与客户的互动价值最大化，并使这样的高水平尽可能保持下去。对于这一阶段的客户，主要应该通过提供优质的服务产品和提高服务水平来提高客户的满意度。通过对常旅客数据库的数据分析，进行客户细分，可以获得重要保持客户的名单。航空公司应该优先将资源投放到他们身上，对他们进行差异化管理和一对一营销，提高这类客户的忠诚度与满意度，尽可能延长这类客户的高水平消费


- 通过发行“联名卡”等与非航空类企业的合作，使客户在其他企业的消费过程中获得本公司的积分，增强与公司的联系，提高他们的忠诚度。例如，可以查看重要客户在非航空类合作伙伴处的里程积累情况，找出他们习惯的里程积累方式（是否经常在合作伙伴处消费、更喜欢消费哪些类型的合作伙伴的产品），为他们制定相应的促销策略


```python

```
